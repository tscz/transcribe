{"version":3,"sources":["components/log/log.ts","components/view/view.tsx","pages/default/defaultPage.tsx","pages/drum/drumPage.tsx","pages/guitar/guitarPage.tsx","pages/harmony/harmonyPage.tsx","pages/print/printPage.tsx","components/contentLayout/contentLayout.tsx","components/sliderInput/sliderInput.tsx","util/ArrayUtil.ts","states/project/projectSlice.ts","states/analysis/analysisSlice.ts","states/analysis/analysisUtil.ts","states/dialog/dialogsSlice.ts","states/audio/audioSlice.ts","states/wave/waveSlice.ts","components/measureSelect/measureSelect.tsx","components/audioManagement/peaksConfig.ts","components/sectionSelect/sectionSelect.tsx","views/structure/structureView.tsx","components/sectionOverview/sectionOverview.tsx","views/structureNavigation/structureNavigationView.tsx","views/wave/waveView.tsx","views/wave/waveContainer.tsx","pages/structure/structurePage.tsx","components/versionInfo/versionInfo.tsx","components/app/logo.svg","components/app/app.tsx","styles/styles.ts","api/persistenceApi.ts","components/fileInput/fileInput.tsx","components/audioManagement/audioPlayer.ts","components/audioManagement/audioManagement.tsx","states/store.ts","components/modalDialog/modalDialog.tsx","components/dialogManagement/dialogManagement.tsx","styles/theme.ts","index.tsx"],"names":["Level","View","Card","style","height","backgroundColor","raised","CardHeader","titleTypographyProps","variant","title","this","props","padding","action","CardContent","body","Component","DefaultPage","React","DrumPage","GuitarPage","HarmonyPage","PrintPage","ContentLayout","Grid","container","spacing","alignItems","item","xs","topLeft","topRight","bottom","LEVEL_TO_COLOR","Map","TRACE","INFO","WARN","ERROR","Log","level","message","source","namespace","createDebug","debug","color","get","generateMessage","SliderInput","FormControl","width","InputLabel","shrink","Box","mt","Slider","value","valueLabelDisplay","min","max","onChange","step","ArrayUtil","range","start","end","Array","fill","map","_","idx","toString","bordersOf","array","parseInt","last","length","LoadingStatus","Page","TimeSignatureType","SectionType","initialProjectState","status","NOT_INITIALIZED","currentPage","DEFAULT","audioUrl","syncFirstMeasureStart","projectSlice","createSlice","name","initialState","reducers","switchedPage","state","payload","createdProject","project","INITIALIZING","hotReloaded","initializedProject","INITIALIZED","enabledSyncFirstMeasureStart","actions","replaceSections","sections","deleteCount","newSections","section","byId","allIds","ids","forEach","id","generateSectionId","push","splice","type","measures","distributeMeasures","timeSignatureType","bpm","firstMeasureStart","lengthOfOneMeasure","FOUR_FOUR","beatUnit","beatsPerMeasure","THREE_FOUR","toTimeSignature","index","time","editable","labelText","DialogType","initialAnalysisState","audioDuration","audioSampleRate","timeSignature","analysisSlice","extraReducers","builder","addCase","analysis","undefinedSectionId","UNDEFINED","undefinedSection","addedSection","addSection","updatedSection","removeSection","before","after","removedSection","updatedRhythm","lastSection","undefined","newLastSection","removeSectionsAfterLastMeasure","lastMeasure","removalStart","removalStartMeasure","newSection","enclosingSection","allSections","newSectionStart","newSectionEnd","sectionCount","current","currentSectionEnd","position","enclosingSectionOf","mergedSections","embeddedSection","currentSectionStart","mergeSections","sectionId","indexOf","firstMeasure","removalCount","audioSlice","isPlaying","detune","playbackRate","triggeredPlay","triggeredPause","updatedPlaybackSettings","initialDialogState","currentDialog","NONE","dialogsSlice","openedDialog","closedDialog","waveSlice","zoom","zoomedOut","zoomedIn","MeasureSelect","event","newMeasure","target","minWidth","disabled","MenuItem","key","PeaksConfig","create","audioBuffer","mediaelement","document","getElementById","containers","zoomview","overview","mediaElement","webAudio","scale","multiChannel","keyboard","pointMarkerColor","showPlayheadTime","zoomLevels","sectionsToSegment","timePerMeasure","segments","segment","startTime","endTime","SECTIONTYPE_TO_COLOR","measuresToPoints","points","point","computeZoomLevels","secondsPerMeasure","zoomviewWidth","measuresCount","baseZoom","Math","floor","levels","INTRO","VERSE","PRECHORUS","CHORUS","SOLO","OUTRO","BRIDGE","SectionSelect","Object","values","sectionType","StructureView","handleAddSection","handleUpdatedSection","info","JSON","stringify","handleRemoveSection","TableContainer","component","Paper","Table","size","TableHead","TableRow","TableCell","TableBody","scope","IconButton","onClick","measure","mapDispatchToProps","connect","SectionOverview","direction","Typography","toLowerCase","marginBottom","arr","res","i","slice","generateMatrix","row","ButtonGroup","orientation","measureId","bg","Square","Button","StructureNavigationView","WaveView","nextProps","url","WaveContainer","audioLoaded","CircularProgress","StructurePage","anchorEl","handleClick","setState","currentTarget","handleClose","handleBpmChange","e","isArray","handleTimeSignatureChange","handleDetuneChange","handlePlaybackRateChange","Divider","fullWidth","Input","startAdornment","InputAdornment","Tooltip","ToggleButton","selected","NativeSelect","icon","Popover","open","Boolean","onClose","anchorOrigin","vertical","horizontal","transformOrigin","ADD_SECTION","WaveformControlButton","marginTop","marginRight","audio","loaded","VersionInfo","version","href","hash","description","_extends","assign","arguments","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","createElement","d","_ref3","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref11","_ref12","_ref13","_ref14","_ref15","_ref16","_ref17","_ref18","_ref19","_ref20","_ref21","_ref22","_ref23","_ref24","_ref25","_ref26","_ref","svgRef","x","y","viewBox","enableBackground","xmlSpace","ref","cx","cy","r","ForwardRef","forwardRef","App","className","classes","root","AppBar","appBar","Toolbar","noWrap","NEW","OPEN","SAVE","Drawer","drawer","paper","drawerPaper","toolbar","List","ListItem","button","STRUCTURE","ListItemIcon","ListItemText","primary","HARMONY","GUITAR","DRUM","PRINT","content","show","justify","process","Toggle","display","children","withStyles","theme","createStyles","zIndex","flexShrink","flexGrow","mixins","marginLeft","withTheme","PersistenceApi","zip","JSZip","loadAsync","archive","file","songFile","async","audioBlob","stateFile","json","parse","window","URL","revokeObjectURL","blob","createObjectURL","save","filename","options","a","fetch","audioFileUrl","response","generateAsync","then","saveAs","FileType","AudioPlayer","peaks","onSongComplete","player","pitchShift","shiftToSemitones","shift","log2","destroy","Tone","context","dispose","setContext","AudioContext","play","Transport","now","getCurrentTime","emit","pause","isSeeking","buffer","toSeconds","getDuration","duration","seek","normalizedTime","seconds","Player","sync","PitchShift","connectSeries","Master","scheduleRepeat","stop","setDetune","pitch","AudioManagement","getPeaks","getPlayer","init","audioCtx","arrayBuffer","decodeAudioData","initPeaks","prevProps","revokeLocalFile","recomputeZoomlevels","repaintWaveform","zoomLevel","setPlaybackRate","newZoomLevels","clientWidth","setZoomLevels","removeAll","add","setZoom","Peaks","err","Error","initPlayer","replacePlayer","on","sampleRate","controls","hidden","src","wave","restoredPersistedState","createAction","createRootReducer","sliceReducer","match","combineReducers","analysisReducer","audioReducer","dialog","dialogReducer","projectReducer","waveReducer","createAppStore","configureStore","reducer","preloadedState","AUDIO","ZIP","FileInput","fileInput","handleChange","fileList","fileURL","getLocalFileUrl","callback","createRef","InputBase","input","placeholder","fileType","inputProps","readOnly","click","aria-label","iconButton","accept","files","flex","ModalDialog","Dialog","onCancel","maxWidth","DialogTitle","DialogContent","DialogContentText","subTitle","DialogActions","label","DialogManagement","onSubmit","zipUrl","store","getState","maxMeasure","NewDialog","useState","fileUrl","setFileUrl","setTitle","TextField","margin","InputProps","OpenDialog","setFile","AddSectionDialog","setSectionType","setStart","setEnd","FormLabel","createMuiTheme","palette","blueGrey","render","ThemeProvider","CssBaseline"],"mappings":"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","file":"static/js/main.f67e7cfa.chunk.js","sourcesContent":["import debug from \"debug\";\r\n\r\nenum Level {\r\n  TRACE = \"trace\",\r\n  INFO = \"info\",\r\n  WARN = \"warn\",\r\n  ERROR = \"error\"\r\n}\r\n\r\nconst LEVEL_TO_COLOR = new Map<Level, string>([\r\n  [Level.TRACE, \"lightblue\"],\r\n  [Level.INFO, \"blue\"],\r\n  [Level.WARN, \"yellow\"],\r\n  [Level.ERROR, \"red\"]\r\n]) as ReadonlyMap<Level, string>;\r\n\r\nclass Log {\r\n  private static generateMessage(\r\n    level: Level,\r\n    message: string,\r\n    source: string\r\n  ) {\r\n    const namespace = `transcribe:${level}`;\r\n    const createDebug = debug(namespace);\r\n\r\n    createDebug.color = LEVEL_TO_COLOR.get(level)!;\r\n\r\n    if (source) {\r\n      createDebug(source, message);\r\n    } else {\r\n      createDebug(message);\r\n    }\r\n  }\r\n\r\n  static trace(message: string, source: string) {\r\n    return this.generateMessage(Level.TRACE, message, source);\r\n  }\r\n\r\n  static info(message: string, source: string) {\r\n    return this.generateMessage(Level.INFO, message, source);\r\n  }\r\n\r\n  static warn(message: string, source: string) {\r\n    return this.generateMessage(Level.WARN, message, source);\r\n  }\r\n\r\n  static error(message: string, source: string) {\r\n    return this.generateMessage(Level.ERROR, message, source);\r\n  }\r\n}\r\n\r\nexport default Log;\r\n","import { CardHeader } from \"@material-ui/core\";\r\nimport Card from \"@material-ui/core/Card\";\r\nimport CardContent from \"@material-ui/core/CardContent\";\r\nimport React, { Component, ReactElement } from \"react\";\r\n\r\ninterface Props {\r\n  body: ReactElement;\r\n  title: string;\r\n  action?: ReactElement;\r\n}\r\n\r\nclass View extends Component<Props> {\r\n  render() {\r\n    return (\r\n      <Card\r\n        style={{\r\n          height: \"100%\",\r\n          backgroundColor: \"#ffffff\"\r\n        }}\r\n        raised={false}\r\n      >\r\n        <CardHeader\r\n          titleTypographyProps={{ variant: \"subtitle1\" }}\r\n          title={this.props.title}\r\n          style={{ backgroundColor: \"#f1f4f6\", padding: \"4px\" }}\r\n          action={this.props.action}\r\n        />\r\n        <CardContent>{this.props.body}</CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n}\r\n\r\nexport default View;\r\n","import React from \"react\";\r\n\r\nimport View from \"../../components/view/view\";\r\n\r\nclass DefaultPage extends React.Component {\r\n  render() {\r\n    return (\r\n      <View\r\n        title=\"Info\"\r\n        body={\r\n          <>\r\n            <p>No Transcription started!!</p>\r\n            <p>Please create a new Transcription or open an existing one.</p>\r\n          </>\r\n        }\r\n      ></View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DefaultPage;\r\n","import React from \"react\";\r\n\r\nimport View from \"../../components/view/view\";\r\n\r\nclass DrumPage extends React.Component {\r\n  render() {\r\n    return (\r\n      <View\r\n        title=\"Drums View\"\r\n        body={\r\n          <p>\r\n            In this section you'll be able to transcribe the drum part. Please\r\n            come back later.\r\n          </p>\r\n        }\r\n      ></View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DrumPage;\r\n","import React from \"react\";\r\n\r\nimport View from \"../../components/view/view\";\r\n\r\nclass GuitarPage extends React.Component {\r\n  render() {\r\n    return (\r\n      <View\r\n        title=\"Guitar\"\r\n        body={\r\n          <p>\r\n            In this section you'll be able to transcribe the guitar part. Please\r\n            come back later.\r\n          </p>\r\n        }\r\n      ></View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default GuitarPage;\r\n","import React from \"react\";\r\n\r\nimport View from \"../../components/view/view\";\r\n\r\nclass HarmonyPage extends React.Component {\r\n  render() {\r\n    return (\r\n      <View\r\n        title=\"Harmony\"\r\n        body={\r\n          <p>\r\n            In this section you'll be able to transcribe the harmony. Please\r\n            come back later.\r\n          </p>\r\n        }\r\n      ></View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default HarmonyPage;\r\n","import React from \"react\";\r\n\r\nimport View from \"../../components/view/view\";\r\n\r\nclass PrintPage extends React.Component {\r\n  render() {\r\n    return (\r\n      <View\r\n        title=\"Print\"\r\n        body={\r\n          <p>\r\n            In this section you'll be able to print the leadsheet. Please come\r\n            back later.\r\n          </p>\r\n        }\r\n      ></View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PrintPage;\r\n","import Grid from \"@material-ui/core/Grid\";\r\nimport React, { ReactElement } from \"react\";\r\n\r\ninterface Props {\r\n  topLeft: ReactElement;\r\n  topRight: ReactElement;\r\n  bottom?: ReactElement;\r\n}\r\n\r\nclass ContentLayout extends React.Component<Props> {\r\n  render() {\r\n    return (\r\n      <Grid container spacing={2} alignItems=\"stretch\">\r\n        <Grid item xs={9}>\r\n          {this.props.topLeft}\r\n        </Grid>\r\n        <Grid item xs={3}>\r\n          {this.props.topRight}\r\n        </Grid>\r\n        <Grid item xs={12}>\r\n          {this.props.bottom}\r\n        </Grid>\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ContentLayout;\r\n","import { Box, FormControl, InputLabel, Slider } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nconst SliderInput = (props: {\r\n  title: string;\r\n  min: number;\r\n  max: number;\r\n  step: number;\r\n  value: number;\r\n  onChange: (event: any, value: number | number[]) => void;\r\n}) => {\r\n  return (\r\n    <FormControl style={{ width: \"100%\" }}>\r\n      <InputLabel shrink>{props.title}</InputLabel>\r\n      <Box mt={2}>\r\n        <Slider\r\n          value={props.value}\r\n          valueLabelDisplay=\"auto\"\r\n          min={props.min}\r\n          max={props.max}\r\n          onChange={props.onChange}\r\n          step={props.step}\r\n        />\r\n      </Box>\r\n    </FormControl>\r\n  );\r\n};\r\n\r\nexport default SliderInput;\r\n","class ArrayUtil {\r\n  static range: (start: number, end: number) => string[] = (start, end) => {\r\n    if (start > end) start = end;\r\n\r\n    return Array(end - start + 1)\r\n      .fill(start)\r\n      .map((_, idx) => (start + idx).toString());\r\n  };\r\n\r\n  static bordersOf: (\r\n    array: Array<any>\r\n  ) => { start: number; end: number } = array => {\r\n    return {\r\n      start: parseInt(array[0]),\r\n      end: parseInt(ArrayUtil.last(array))\r\n    };\r\n  };\r\n\r\n  static last: <T>(array: Array<T>) => T = array => {\r\n    return array[array.length - 1];\r\n  };\r\n}\r\n\r\nexport default ArrayUtil;\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nimport { PersistedState } from \"../store\";\r\n\r\nexport interface ProjectState {\r\n  readonly status: LoadingStatus;\r\n  readonly currentPage: Page;\r\n  readonly title: string;\r\n  readonly audioUrl: string;\r\n  readonly syncFirstMeasureStart: boolean;\r\n}\r\n\r\nexport enum LoadingStatus {\r\n  NOT_INITIALIZED = \"not_initialized\",\r\n  INITIALIZING = \"initializing\",\r\n  INITIALIZED = \"initialized\"\r\n}\r\n\r\nexport enum Page {\r\n  DEFAULT = \"default\",\r\n  STRUCTURE = \"structure\",\r\n  HARMONY = \"harmony\",\r\n  GUITAR = \"guitar\",\r\n  DRUM = \"drum\",\r\n  PRINT = \"print\"\r\n}\r\n\r\nexport const initialProjectState: ProjectState = {\r\n  status: LoadingStatus.NOT_INITIALIZED,\r\n  currentPage: Page.DEFAULT,\r\n  title: \"\",\r\n  audioUrl: \"\",\r\n  syncFirstMeasureStart: false\r\n};\r\n\r\nconst projectSlice = createSlice({\r\n  name: \"project\",\r\n  initialState: initialProjectState,\r\n  reducers: {\r\n    switchedPage(state, action: PayloadAction<Page>) {\r\n      state.currentPage = action.payload;\r\n    },\r\n    createdProject(state, action: PayloadAction<PersistedState>) {\r\n      return { ...action.payload.project, status: LoadingStatus.INITIALIZING };\r\n    },\r\n    hotReloaded(state) {\r\n      state.status = LoadingStatus.INITIALIZING;\r\n    },\r\n    initializedProject(\r\n      state,\r\n      action: PayloadAction<{ audioDuration: number; audioSampleRate: number }>\r\n    ) {\r\n      state.status = LoadingStatus.INITIALIZED;\r\n    },\r\n    enabledSyncFirstMeasureStart(state, action: PayloadAction<boolean>) {\r\n      state.syncFirstMeasureStart = action.payload;\r\n    }\r\n  }\r\n});\r\n\r\nexport const {\r\n  switchedPage,\r\n  createdProject,\r\n  initializedProject,\r\n  hotReloaded,\r\n  enabledSyncFirstMeasureStart\r\n} = projectSlice.actions;\r\n\r\nexport default projectSlice.reducer;\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\nimport { PointAddOptions } from \"peaks.js\";\r\n\r\nimport ArrayUtil from \"../../util/ArrayUtil\";\r\nimport { createdProject, initializedProject } from \"../project/projectSlice\";\r\nimport { NormalizedObjects } from \"../store\";\r\nimport {\r\n  distributeMeasures,\r\n  enclosingSectionOf,\r\n  generateSectionId,\r\n  mergeSections,\r\n  replaceSections,\r\n  sectionInvalid,\r\n  undefinedSection\r\n} from \"./analysisUtil\";\r\n\r\nexport interface AnalysisState {\r\n  readonly sections: NormalizedObjects<Section>;\r\n  readonly audioDuration: number;\r\n  readonly audioSampleRate: number;\r\n  readonly firstMeasureStart: number;\r\n  readonly timeSignature: TimeSignatureType;\r\n  readonly bpm: number;\r\n  readonly measures: NormalizedObjects<Measure>;\r\n}\r\n\r\nexport interface Section {\r\n  type: SectionType;\r\n  measures: string[];\r\n}\r\n\r\nexport interface Measure extends PointAddOptions {}\r\n\r\nexport interface TimeSignature {\r\n  beatsPerMeasure: number;\r\n  beatUnit: number;\r\n}\r\n\r\nexport enum TimeSignatureType {\r\n  FOUR_FOUR = \"FOUR_FOUR\",\r\n  THREE_FOUR = \"THREE_FOUR\"\r\n}\r\n\r\nexport enum SectionType {\r\n  INTRO = \"INTRO\",\r\n  VERSE = \"VERSE\",\r\n  PRECHORUS = \"PRECHORUS\",\r\n  CHORUS = \"CHORUS\",\r\n  BRIDGE = \"BRIDGE\",\r\n  SOLO = \"SOLO\",\r\n  OUTRO = \"OUTRO\",\r\n  UNDEFINED = \"UNDEFINED\"\r\n}\r\n\r\nexport const initialAnalysisState: AnalysisState = {\r\n  sections: { allIds: [], byId: {} },\r\n  bpm: 120,\r\n  firstMeasureStart: 0,\r\n  audioDuration: 180,\r\n  audioSampleRate: 44400,\r\n  measures: { allIds: [], byId: {} },\r\n  timeSignature: TimeSignatureType.FOUR_FOUR\r\n};\r\n\r\nconst analysisSlice = createSlice({\r\n  name: \"analysis\",\r\n  initialState: initialAnalysisState,\r\n  extraReducers: builder =>\r\n    builder\r\n      .addCase(createdProject, (state, action) => {\r\n        return action.payload.analysis;\r\n      })\r\n      .addCase(initializedProject, (state, action) => {\r\n        state.audioDuration = action.payload.audioDuration;\r\n        state.audioSampleRate = action.payload.audioSampleRate;\r\n\r\n        state.measures = distributeMeasures(\r\n          state.timeSignature,\r\n          state.bpm,\r\n          state.firstMeasureStart,\r\n          state.audioDuration\r\n        );\r\n\r\n        if (state.sections.allIds.length === 0)\r\n          state.sections = undefinedSection(state.measures.allIds.length - 1);\r\n      }),\r\n  reducers: {\r\n    addedSection(state, action: PayloadAction<Section>) {\r\n      return addSection(state, action.payload);\r\n    },\r\n    updatedSection(\r\n      state,\r\n      action: PayloadAction<{ before: string; after: Section }>\r\n    ) {\r\n      removeSection(state, action.payload.before);\r\n      return addSection(state, action.payload.after);\r\n    },\r\n    removedSection(state, action: PayloadAction<string>) {\r\n      removeSection(state, action.payload);\r\n\r\n      return state;\r\n    },\r\n    updatedRhythm(\r\n      state,\r\n      action: PayloadAction<{\r\n        firstMeasureStart?: number;\r\n        bpm?: number;\r\n        timeSignatureType?: TimeSignatureType;\r\n      }>\r\n    ) {\r\n      state.bpm = action.payload.bpm ?? state.bpm;\r\n      state.firstMeasureStart =\r\n        action.payload.firstMeasureStart ?? state.firstMeasureStart;\r\n      state.timeSignature =\r\n        action.payload.timeSignatureType ?? state.timeSignature;\r\n\r\n      state.measures = distributeMeasures(\r\n        state.timeSignature,\r\n        state.bpm,\r\n        state.firstMeasureStart,\r\n        state.audioDuration\r\n      );\r\n\r\n      const lastSection =\r\n        state.sections.byId[\r\n          state.sections.allIds[state.sections.allIds.length - 1]\r\n        ];\r\n\r\n      if (lastSection === undefined) return state;\r\n\r\n      if (\r\n        parseInt(ArrayUtil.last(state.measures.allIds)) >\r\n        parseInt(lastSection.measures[lastSection.measures.length - 1])\r\n      ) {\r\n        const newLastSection: Section = {\r\n          type: lastSection.type,\r\n          measures: ArrayUtil.range(\r\n            parseInt(lastSection.measures[0]),\r\n            parseInt(ArrayUtil.last(state.measures.allIds))\r\n          )\r\n        };\r\n        const id = generateSectionId(newLastSection);\r\n        delete state.sections.byId[\r\n          state.sections.allIds[state.sections.allIds.length - 1]\r\n        ];\r\n        state.sections.allIds[state.sections.allIds.length - 1] = id;\r\n        state.sections.byId[id] = newLastSection;\r\n      }\r\n\r\n      removeSectionsAfterLastMeasure(state);\r\n\r\n      return state;\r\n    }\r\n  }\r\n});\r\n\r\nconst removeSectionsAfterLastMeasure: (\r\n  state: AnalysisState\r\n) => void = state => {\r\n  const lastMeasure = state.measures.allIds.length - 1;\r\n  let removalStart = -1;\r\n  let removalStartMeasure = -1;\r\n\r\n  for (let index = 0; index <= state.sections.allIds.length - 1; index++) {\r\n    const section = state.sections.byId[state.sections.allIds[index]];\r\n    const sectionEnd = parseInt(ArrayUtil.last(section.measures));\r\n\r\n    if (sectionEnd > lastMeasure) {\r\n      removalStart = index;\r\n      removalStartMeasure = parseInt(section.measures[0]);\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (removalStart === -1) return; // No sections after last measure\r\n\r\n  replaceSections(\r\n    state.sections,\r\n    removalStart,\r\n    state.sections.allIds.length - removalStart,\r\n    [\r\n      {\r\n        measures: ArrayUtil.range(removalStartMeasure, lastMeasure),\r\n        type: SectionType.UNDEFINED\r\n      }\r\n    ]\r\n  );\r\n};\r\n\r\nconst addSection: (\r\n  state: AnalysisState,\r\n  newSection: Section\r\n) => AnalysisState = (state, newSection) => {\r\n  if (sectionInvalid(newSection)) return state;\r\n\r\n  let enclosingSection = enclosingSectionOf(newSection, state.sections);\r\n  if (\r\n    enclosingSection === undefined ||\r\n    enclosingSection.section.type !== SectionType.UNDEFINED\r\n  )\r\n    return state;\r\n\r\n  let mergedSections = mergeSections(enclosingSection.section, newSection);\r\n\r\n  replaceSections(state.sections, enclosingSection.position, 1, mergedSections);\r\n\r\n  return state;\r\n};\r\n\r\nconst removeSection: (state: AnalysisState, sectionId: string) => void = (\r\n  state,\r\n  sectionId\r\n) => {\r\n  let position = state.sections.allIds.indexOf(sectionId);\r\n  let section = state.sections.byId[sectionId];\r\n\r\n  let before = state.sections.allIds[position - 1];\r\n  let after = state.sections.allIds[position + 1];\r\n\r\n  let { start: firstMeasure, end: lastMeasure } = ArrayUtil.bordersOf(\r\n    section.measures\r\n  );\r\n  let removalStart = position;\r\n  let removalCount = 1;\r\n\r\n  if (\r\n    before !== undefined &&\r\n    state.sections.byId[before].type === SectionType.UNDEFINED\r\n  ) {\r\n    removalStart--;\r\n    removalCount++;\r\n    firstMeasure = parseInt(state.sections.byId[before].measures[0]);\r\n  }\r\n\r\n  if (\r\n    after !== undefined &&\r\n    state.sections.byId[after].type === SectionType.UNDEFINED\r\n  ) {\r\n    removalCount++;\r\n    lastMeasure = parseInt(ArrayUtil.last(state.sections.byId[after].measures));\r\n  }\r\n\r\n  replaceSections(state.sections, removalStart, removalCount, [\r\n    {\r\n      measures: ArrayUtil.range(firstMeasure, lastMeasure),\r\n      type: SectionType.UNDEFINED\r\n    }\r\n  ]);\r\n};\r\n\r\nexport const {\r\n  addedSection,\r\n  removedSection,\r\n  updatedRhythm,\r\n  updatedSection\r\n} = analysisSlice.actions;\r\n\r\nexport default analysisSlice.reducer;\r\n","import ArrayUtil from \"../../util/ArrayUtil\";\r\nimport { NormalizedObjects } from \"../store\";\r\nimport {\r\n  Measure,\r\n  Section,\r\n  SectionType,\r\n  TimeSignatureType\r\n} from \"./analysisSlice\";\r\n\r\nexport const toTimeSignature = (type: TimeSignatureType) => {\r\n  switch (type) {\r\n    case TimeSignatureType.FOUR_FOUR:\r\n      return { beatUnit: 4, beatsPerMeasure: 4 };\r\n    case TimeSignatureType.THREE_FOUR:\r\n      return { beatUnit: 4, beatsPerMeasure: 3 };\r\n  }\r\n};\r\n\r\nexport const undefinedSection = (length: number) => {\r\n  let undefinedSectionId = \"UNDEFINED_0_\" + length;\r\n  let sections: NormalizedObjects<Section>;\r\n\r\n  sections = {\r\n    allIds: [undefinedSectionId],\r\n    byId: {}\r\n  };\r\n\r\n  sections.byId[undefinedSectionId] = {\r\n    measures: ArrayUtil.range(0, length),\r\n    type: SectionType.UNDEFINED\r\n  };\r\n\r\n  return sections;\r\n};\r\n\r\nexport const sectionInvalid = (section: Section) => {\r\n  return (\r\n    parseInt(section.measures[0]) >\r\n    parseInt(section.measures[section.measures.length - 1])\r\n  );\r\n};\r\n\r\nexport const enclosingSectionOf = (\r\n  section: Section,\r\n  allSections: NormalizedObjects<Section>\r\n) => {\r\n  const { start: newSectionStart, end: newSectionEnd } = ArrayUtil.bordersOf(\r\n    section.measures\r\n  );\r\n\r\n  const sectionCount = allSections.allIds.length;\r\n\r\n  for (let current = 0; current <= sectionCount - 1; current++) {\r\n    let section = allSections.byId[allSections.allIds[current]];\r\n    let { end: currentSectionEnd } = ArrayUtil.bordersOf(section.measures);\r\n\r\n    //Go to next section if not included\r\n    if (newSectionStart >= currentSectionEnd) continue;\r\n\r\n    //Exit if new section overlaps current section's border\r\n    if (newSectionEnd > currentSectionEnd) return undefined;\r\n\r\n    return { position: current, section: section };\r\n  }\r\n};\r\n\r\nexport const mergeSections: (\r\n  enclosingSection: Section,\r\n  embeddedSection: Section\r\n) => Section[] = (enclosingSection, embeddedSection) => {\r\n  let newSections: Section[] = [];\r\n\r\n  const { start: newSectionStart, end: newSectionEnd } = ArrayUtil.bordersOf(\r\n    embeddedSection.measures\r\n  );\r\n\r\n  const {\r\n    start: currentSectionStart,\r\n    end: currentSectionEnd\r\n  } = ArrayUtil.bordersOf(enclosingSection.measures);\r\n\r\n  //Add a new undefined block before the new section\r\n  if (newSectionStart > currentSectionStart) {\r\n    let section: Section = {\r\n      measures: ArrayUtil.range(currentSectionStart, newSectionStart - 1),\r\n      type: SectionType.UNDEFINED\r\n    };\r\n    newSections.push(section);\r\n  }\r\n\r\n  //add new section\r\n  newSections.push(embeddedSection);\r\n\r\n  //Add a new undefined block after the new section\r\n  if (newSectionEnd < currentSectionEnd) {\r\n    let section: Section = {\r\n      measures: ArrayUtil.range(newSectionEnd + 1, currentSectionEnd),\r\n      type: SectionType.UNDEFINED\r\n    };\r\n    newSections.push(section);\r\n  }\r\n\r\n  return newSections;\r\n};\r\n\r\nexport const replaceSections = (\r\n  sections: NormalizedObjects<Section>,\r\n  start: number,\r\n  deleteCount: number,\r\n  newSections: Section[]\r\n) => {\r\n  for (let section = start; section < deleteCount; section++) {\r\n    delete sections.byId[sections.allIds[section]];\r\n  }\r\n\r\n  let ids: string[] = [];\r\n\r\n  newSections.forEach(section => {\r\n    const id = generateSectionId(section);\r\n    ids.push(id);\r\n    sections.byId[id] = section;\r\n  });\r\n\r\n  sections.allIds.splice(start, deleteCount, ...ids);\r\n};\r\n\r\nexport const generateSectionId = (section: Section) =>\r\n  section.type +\r\n  \"_\" +\r\n  section.measures[0] +\r\n  \"_\" +\r\n  section.measures[section.measures.length - 1];\r\n\r\nexport const distributeMeasures = (\r\n  timeSignatureType: TimeSignatureType,\r\n  bpm: number,\r\n  firstMeasureStart: number,\r\n  length: number\r\n) => {\r\n  const timeSignature = toTimeSignature(timeSignatureType);\r\n  const lengthOfOneMeasure = (60 * timeSignature.beatsPerMeasure) / bpm;\r\n  const measures: NormalizedObjects<Measure> = { allIds: [], byId: {} };\r\n\r\n  let index = 0;\r\n  for (\r\n    let start = firstMeasureStart;\r\n    start < length;\r\n    start += lengthOfOneMeasure\r\n  ) {\r\n    measures.allIds.push(\"\" + index);\r\n    measures.byId[index] = {\r\n      time: start,\r\n      color: \"\",\r\n      editable: false,\r\n      id: \"\" + index,\r\n      labelText: \"\" + index\r\n    };\r\n    index++;\r\n  }\r\n\r\n  return measures;\r\n};\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport interface DialogState {\r\n  readonly currentDialog: DialogType;\r\n}\r\n\r\nexport enum DialogType {\r\n  NONE = \"none\",\r\n  NEW = \"new\",\r\n  OPEN = \"open\",\r\n  SAVE = \"save\",\r\n  ADD_SECTION = \"add_section\"\r\n}\r\n\r\nconst initialDialogState: DialogState = {\r\n  currentDialog: DialogType.NONE\r\n};\r\n\r\nconst dialogsSlice = createSlice({\r\n  name: \"dialogs\",\r\n  initialState: initialDialogState,\r\n  reducers: {\r\n    openedDialog(state, action: PayloadAction<DialogType>) {\r\n      state.currentDialog = action.payload;\r\n    },\r\n    closedDialog(state) {\r\n      state.currentDialog = DialogType.NONE;\r\n    }\r\n  }\r\n});\r\n\r\nexport const { openedDialog, closedDialog } = dialogsSlice.actions;\r\n\r\nexport default dialogsSlice.reducer;\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport interface AudioState {\r\n  readonly isPlaying: boolean;\r\n  readonly detune: number;\r\n  readonly playbackRate: number;\r\n}\r\n\r\nexport interface PlaybackSettings {\r\n  readonly detune?: number;\r\n  readonly playbackRate?: number;\r\n}\r\n\r\nexport const initialAudioState: AudioState = {\r\n  isPlaying: false,\r\n  detune: 0,\r\n  playbackRate: 1\r\n};\r\n\r\nconst audioSlice = createSlice({\r\n  name: \"audio\",\r\n  initialState: initialAudioState,\r\n  reducers: {\r\n    triggeredPlay(state) {\r\n      state.isPlaying = true;\r\n    },\r\n    triggeredPause(state) {\r\n      state.isPlaying = false;\r\n    },\r\n    updatedPlaybackSettings(\r\n      state,\r\n      action: PayloadAction<{ playbackRate?: number; detune?: number }>\r\n    ) {\r\n      if (action.payload.detune !== undefined)\r\n        state.detune = action.payload.detune;\r\n      if (action.payload.playbackRate !== undefined)\r\n        state.playbackRate = action.payload.playbackRate;\r\n    }\r\n  }\r\n});\r\n\r\nexport const {\r\n  triggeredPause,\r\n  triggeredPlay,\r\n  updatedPlaybackSettings\r\n} = audioSlice.actions;\r\n\r\nexport default audioSlice.reducer;\r\n","import { createSlice } from \"@reduxjs/toolkit\";\r\n\r\nexport interface WaveState {\r\n  readonly zoom: number;\r\n}\r\n\r\nexport const initialWaveState: WaveState = {\r\n  zoom: 0\r\n};\r\n\r\nconst waveSlice = createSlice({\r\n  name: \"wave\",\r\n  initialState: initialWaveState,\r\n  reducers: {\r\n    zoomedOut(state) {\r\n      state.zoom =\r\n        state.zoom === 42 //TODO: use max zoomlevel here, which is dynamic\r\n          ? state.zoom\r\n          : state.zoom + 1;\r\n    },\r\n    zoomedIn(state) {\r\n      state.zoom = state.zoom === 0 ? state.zoom : state.zoom - 1;\r\n    }\r\n  }\r\n});\r\n\r\nexport const { zoomedIn, zoomedOut } = waveSlice.actions;\r\n\r\nexport default waveSlice.reducer;\r\n","import { MenuItem } from \"@material-ui/core\";\r\nimport Select from \"@material-ui/core/Select/Select\";\r\nimport React, { FunctionComponent } from \"react\";\r\n\r\nconst MeasureSelect: FunctionComponent<{\r\n  value: number;\r\n  min: number;\r\n  max: number;\r\n  onChange: (value: number) => void;\r\n  disabled?: boolean;\r\n}> = props => {\r\n  const handleChange = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    let newMeasure = event.target.value as number;\r\n    props.onChange(newMeasure);\r\n  };\r\n\r\n  return (\r\n    <Select\r\n      value={props.value}\r\n      onChange={handleChange}\r\n      style={{\r\n        minWidth: \"40px\"\r\n      }}\r\n      disabled={props.disabled}\r\n    >\r\n      {new Array<number>(props.max - props.min + 1)\r\n        .fill(0)\r\n        .map((_, idx: number) => {\r\n          return (\r\n            <MenuItem key={props.min + idx} value={props.min + idx}>\r\n              {props.min + idx}\r\n            </MenuItem>\r\n          );\r\n        })}\r\n    </Select>\r\n  );\r\n};\r\n\r\nexport default MeasureSelect;\r\n","import { PointAddOptions, SegmentAddOptions } from \"peaks.js\";\r\n\r\nimport {\r\n  Measure,\r\n  Section,\r\n  SectionType\r\n} from \"../../states/analysis/analysisSlice\";\r\nimport { NormalizedObjects } from \"../../states/store\";\r\n\r\nexport const AUDIO_DOM_ELEMENT = \"audio_dom_element\";\r\nexport const ZOOMVIEW_CONTAINER = \"zoomview-container\";\r\nexport const OVERVIEW_CONTAINER = \"overview-container\";\r\n\r\nclass PeaksConfig {\r\n  static create = (audioBuffer: AudioBuffer) => {\r\n    let mediaelement = document!.getElementById(\r\n      AUDIO_DOM_ELEMENT\r\n    )! as HTMLAudioElement;\r\n\r\n    return {\r\n      containers: {\r\n        zoomview: document!.getElementById(ZOOMVIEW_CONTAINER)!,\r\n        overview: document!.getElementById(OVERVIEW_CONTAINER)!\r\n      },\r\n      mediaElement: mediaelement,\r\n      webAudio: {\r\n        audioBuffer: audioBuffer,\r\n        scale: 128,\r\n        multiChannel: false\r\n      },\r\n      keyboard: true,\r\n      pointMarkerColor: \"#006eb0\",\r\n      showPlayheadTime: true,\r\n      zoomLevels: [42] //TODO: Define good initial default\r\n    };\r\n  };\r\n\r\n  static sectionsToSegment = (\r\n    sections: NormalizedObjects<Section>,\r\n    measures: NormalizedObjects<Measure>,\r\n    timePerMeasure: number\r\n  ) => {\r\n    let segments: SegmentAddOptions[] = [];\r\n    sections.allIds.forEach(id => {\r\n      const section = sections.byId[id];\r\n\r\n      const start = measures.byId[section.measures[0]].time;\r\n      const end =\r\n        measures.byId[section.measures[section.measures.length - 1]].time +\r\n        timePerMeasure;\r\n\r\n      let segment: SegmentAddOptions = {\r\n        id,\r\n        labelText: section.type,\r\n        startTime: start,\r\n        endTime: end,\r\n        color: PeaksConfig.SECTIONTYPE_TO_COLOR.get(section.type),\r\n        editable: false\r\n      };\r\n\r\n      segments.push(segment);\r\n    });\r\n\r\n    return segments;\r\n  };\r\n\r\n  static measuresToPoints = (measures: NormalizedObjects<Measure>) => {\r\n    let points: PointAddOptions[] = [];\r\n    measures.allIds.forEach(id => {\r\n      const measure = measures.byId[id];\r\n\r\n      let point: PointAddOptions = measure;\r\n\r\n      points.push(point);\r\n    });\r\n\r\n    return points;\r\n  };\r\n\r\n  static computeZoomLevels = (\r\n    secondsPerMeasure: number,\r\n    audioSampleRate: number,\r\n    zoomviewWidth: number,\r\n    measuresCount: number\r\n  ) => {\r\n    const baseZoom = Math.floor(\r\n      (secondsPerMeasure * audioSampleRate) / zoomviewWidth\r\n    );\r\n\r\n    let levels = new Array<number>(measuresCount);\r\n\r\n    for (let index = 0; index < levels.length; index++) {\r\n      levels[index] = baseZoom * (index + 1);\r\n    }\r\n\r\n    return levels;\r\n  };\r\n\r\n  static SECTIONTYPE_TO_COLOR = new Map<SectionType, string>([\r\n    [SectionType.INTRO, \"#FFCA28\"],\r\n    [SectionType.VERSE, \"#FFA726\"],\r\n    [SectionType.PRECHORUS, \"#FF7043\"],\r\n    [SectionType.CHORUS, \"#9CCC65\"],\r\n    [SectionType.SOLO, \"#26C6DA\"],\r\n    [SectionType.OUTRO, \"#5C6BC0\"],\r\n    [SectionType.BRIDGE, \"#EC407A\"],\r\n    [SectionType.VERSE, \"#78909C\"],\r\n    [SectionType.UNDEFINED, \"#ffffff\"]\r\n  ]) as ReadonlyMap<SectionType, string>;\r\n}\r\n\r\nexport default PeaksConfig;\r\n","import { MenuItem } from \"@material-ui/core\";\r\nimport Select from \"@material-ui/core/Select/Select\";\r\nimport React, { FunctionComponent } from \"react\";\r\n\r\nimport { SectionType } from \"../../states/analysis/analysisSlice\";\r\nimport PeaksConfig from \"../audioManagement/peaksConfig\";\r\n\r\nconst SectionSelect: FunctionComponent<{\r\n  value: SectionType;\r\n  onChange: (sectionType: SectionType) => void;\r\n}> = props => {\r\n  const handleChange = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    let newSection = event.target.value as SectionType;\r\n    props.onChange(newSection);\r\n  };\r\n\r\n  return (\r\n    <Select\r\n      value={props.value}\r\n      onChange={handleChange}\r\n      style={{\r\n        backgroundColor: PeaksConfig.SECTIONTYPE_TO_COLOR.get(props.value),\r\n        minWidth: \"140px\"\r\n      }}\r\n    >\r\n      {Object.values(SectionType).map(sectionType => {\r\n        return sectionType === SectionType.UNDEFINED ? (\r\n          undefined\r\n        ) : (\r\n          <MenuItem\r\n            key={sectionType}\r\n            value={sectionType}\r\n            style={{\r\n              backgroundColor: PeaksConfig.SECTIONTYPE_TO_COLOR.get(sectionType)\r\n            }}\r\n          >\r\n            {sectionType}\r\n          </MenuItem>\r\n        );\r\n      })}\r\n    </Select>\r\n  );\r\n};\r\n\r\nexport default SectionSelect;\r\n","import {\r\n  IconButton,\r\n  Paper,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow\r\n} from \"@material-ui/core\";\r\nimport RemoveIcon from \"@material-ui/icons/Remove\";\r\nimport React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport Log from \"../../components/log/log\";\r\nimport MeasureSelect from \"../../components/measureSelect/measureSelect\";\r\nimport SectionSelect from \"../../components/sectionSelect/sectionSelect\";\r\nimport {\r\n  addedSection,\r\n  removedSection,\r\n  Section,\r\n  SectionType,\r\n  updatedSection\r\n} from \"../../states/analysis/analysisSlice\";\r\nimport { ApplicationState, NormalizedObjects } from \"../../states/store\";\r\nimport ArrayUtil from \"../../util/ArrayUtil\";\r\n\r\ninterface PropsFromState {\r\n  readonly sections: NormalizedObjects<Section>;\r\n  readonly measuresCount: number;\r\n}\r\n\r\ninterface PropsFromDispatch {\r\n  addedSection: typeof addedSection;\r\n  updatedSection: typeof updatedSection;\r\n  removedSection: typeof removedSection;\r\n}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch;\r\n\r\nclass StructureView extends Component<AllProps> {\r\n  handleAddSection = (section: Section) => {\r\n    this.props.addedSection(section);\r\n  };\r\n\r\n  handleUpdatedSection = (id: string, before: Section, after: Section) => {\r\n    Log.info(\r\n      \"Change section \" +\r\n        id +\r\n        \" from \" +\r\n        JSON.stringify(before) +\r\n        \" to \" +\r\n        JSON.stringify(after),\r\n      StructureView.name\r\n    );\r\n\r\n    if (\r\n      parseInt(after.measures[0]) >\r\n      parseInt(after.measures[after.measures.length - 1])\r\n    )\r\n      return;\r\n\r\n    this.props.updatedSection({ before: id, after });\r\n  };\r\n\r\n  handleRemoveSection = (id: string) => {\r\n    this.props.removedSection(id);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <TableContainer component={Paper}>\r\n        <Table size=\"small\">\r\n          <TableHead>\r\n            <TableRow>\r\n              <TableCell style={{ width: \"10%\" }}></TableCell>\r\n              <TableCell style={{ width: \"30%\" }}>Section</TableCell>\r\n              <TableCell style={{ width: \"30%\" }}>First Measure</TableCell>\r\n              <TableCell style={{ width: \"30%\" }}>Last Measure</TableCell>\r\n            </TableRow>\r\n          </TableHead>\r\n          <TableBody>\r\n            {this.props.sections.allIds.map((id: string) => {\r\n              let section = this.props.sections.byId[id];\r\n              return (\r\n                <TableRow key={id}>\r\n                  <TableCell component=\"th\" scope=\"row\">\r\n                    {section.type !== SectionType.UNDEFINED && (\r\n                      <IconButton\r\n                        onClick={() => this.handleRemoveSection(id)}\r\n                        size=\"small\"\r\n                      >\r\n                        <RemoveIcon></RemoveIcon>\r\n                      </IconButton>\r\n                    )}\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    {section.type === SectionType.UNDEFINED ? (\r\n                      \"UNDEFINED\"\r\n                    ) : (\r\n                      <SectionSelect\r\n                        value={section.type}\r\n                        onChange={sectionType =>\r\n                          this.handleUpdatedSection(id, section, {\r\n                            ...section,\r\n                            type: sectionType\r\n                          })\r\n                        }\r\n                      ></SectionSelect>\r\n                    )}\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <MeasureSelect\r\n                      disabled={section.type === SectionType.UNDEFINED}\r\n                      value={parseInt(section.measures[0])}\r\n                      min={0}\r\n                      max={this.props.measuresCount - 1}\r\n                      onChange={measure =>\r\n                        this.handleUpdatedSection(id, section, {\r\n                          ...section,\r\n                          measures: ArrayUtil.range(\r\n                            measure,\r\n                            parseInt(\r\n                              section.measures[section.measures.length - 1]\r\n                            )\r\n                          )\r\n                        })\r\n                      }\r\n                    />\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <MeasureSelect\r\n                      disabled={section.type === SectionType.UNDEFINED}\r\n                      value={parseInt(\r\n                        section.measures[section.measures.length - 1]\r\n                      )}\r\n                      min={0}\r\n                      max={this.props.measuresCount - 1}\r\n                      onChange={measure =>\r\n                        this.handleUpdatedSection(id, section, {\r\n                          ...section,\r\n                          measures: ArrayUtil.range(\r\n                            parseInt(section.measures[0]),\r\n                            measure\r\n                          )\r\n                        })\r\n                      }\r\n                    />\r\n                  </TableCell>\r\n                </TableRow>\r\n              );\r\n            })}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({ analysis }: ApplicationState) => {\r\n  return {\r\n    sections: analysis.sections,\r\n    measuresCount: analysis.measures.allIds.length\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  addedSection,\r\n  updatedSection,\r\n  removedSection\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(StructureView);\r\n","import { Button, ButtonGroup, Grid, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { Measure, Section } from \"../../states/analysis/analysisSlice\";\r\nimport { ApplicationState, NormalizedObjects } from \"../../states/store\";\r\nimport PeaksConfig from \"../audioManagement/peaksConfig\";\r\n\r\ninterface PropsFromState {\r\n  sections: NormalizedObjects<Section>;\r\n  measures: NormalizedObjects<Measure>;\r\n}\r\n\r\ninterface PropsFromDispatch {}\r\n\r\ninterface Props {}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch & Props;\r\n\r\nclass SectionOverview extends React.Component<AllProps> {\r\n  render() {\r\n    let { sections, measures } = this.props;\r\n\r\n    let generateMatrix = (arr: string[], size: number) => {\r\n      var res = [];\r\n      for (var i = 0; i < arr.length; i = i + size)\r\n        res.push(arr.slice(i, i + size));\r\n      return res;\r\n    };\r\n\r\n    return (\r\n      <>\r\n        <Grid container direction=\"column\">\r\n          {sections.allIds.map(sectionId => (\r\n            <Grid item key={sectionId}>\r\n              <Grid container direction=\"column\">\r\n                <Grid item key={sectionId + \"_caption\"}>\r\n                  <Typography variant=\"caption\">\r\n                    {sections.byId[sectionId].type.toLowerCase()}\r\n                  </Typography>\r\n                </Grid>\r\n                <Grid item key={sectionId + \"_body\"}>\r\n                  <Grid\r\n                    container\r\n                    direction=\"column\"\r\n                    style={{ marginBottom: \"5px\" }}\r\n                  >\r\n                    {generateMatrix(sections.byId[sectionId].measures, 8).map(\r\n                      row => (\r\n                        <ButtonGroup\r\n                          key={sectionId + \"_buttonGroup_\" + row[0]}\r\n                          orientation=\"horizontal\"\r\n                          size=\"small\"\r\n                        >\r\n                          {row.map(measureId => {\r\n                            let measure: Measure = measures.byId[measureId];\r\n\r\n                            return (\r\n                              <Square\r\n                                key={measure.id}\r\n                                value={measure.id!}\r\n                                bg={\r\n                                  PeaksConfig.SECTIONTYPE_TO_COLOR.get(\r\n                                    sections.byId[sectionId].type\r\n                                  )!\r\n                                }\r\n                              ></Square>\r\n                            );\r\n                          })}\r\n                        </ButtonGroup>\r\n                      )\r\n                    )}\r\n                  </Grid>\r\n                </Grid>\r\n              </Grid>\r\n            </Grid>\r\n          ))}\r\n        </Grid>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nclass Square extends React.Component<{\r\n  value: string;\r\n  bg: string;\r\n}> {\r\n  render() {\r\n    return (\r\n      <Button\r\n        {...this.props}\r\n        style={{\r\n          backgroundColor: this.props.bg\r\n        }}\r\n      >\r\n        {this.props.value}\r\n      </Button>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({ analysis }: ApplicationState) => {\r\n  return {\r\n    sections: analysis.sections,\r\n    measures: analysis.measures\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(SectionOverview);\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport SectionOverview from \"../../components/sectionOverview/sectionOverview\";\r\nimport { ApplicationState } from \"../../states/store\";\r\n\r\ninterface PropsFromState {}\r\n\r\ninterface PropsFromDispatch {}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch;\r\n\r\nclass StructureNavigationView extends Component<AllProps> {\r\n  render() {\r\n    return <SectionOverview></SectionOverview>;\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({ analysis }: ApplicationState) => {\r\n  return {};\r\n};\r\n\r\nconst mapDispatchToProps = {};\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(StructureNavigationView);\r\n","import React, { Component } from \"react\";\r\n\r\nimport {\r\n  OVERVIEW_CONTAINER,\r\n  ZOOMVIEW_CONTAINER\r\n} from \"../../components/audioManagement/peaksConfig\";\r\nimport Log from \"../../components/log/log\";\r\n\r\ninterface Props {\r\n  url: string;\r\n}\r\n\r\nexport default class WaveView extends Component<Props> {\r\n  shouldComponentUpdate(nextProps: Props) {\r\n    return nextProps.url !== this.props.url;\r\n  }\r\n\r\n  render() {\r\n    Log.info(\"render with url=\" + this.props.url, WaveView.name);\r\n    return (\r\n      <div>\r\n        <div id=\"waveform-container\">\r\n          <div id={ZOOMVIEW_CONTAINER}></div>\r\n          <div id={OVERVIEW_CONTAINER}></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport Log from \"../../components/log/log\";\r\nimport { hotReloaded, LoadingStatus } from \"../../states/project/projectSlice\";\r\nimport { ApplicationState } from \"../../states/store\";\r\nimport WaveView from \"./waveView\";\r\n\r\ninterface PropsFromState {\r\n  audioLoaded: LoadingStatus;\r\n  audioUrl: string;\r\n}\r\n\r\ninterface PropsFromDispatch {\r\n  hotReloaded: typeof hotReloaded;\r\n}\r\n\r\ninterface Props {}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch & Props;\r\n\r\nclass WaveContainer extends Component<AllProps> {\r\n  constructor(props: AllProps) {\r\n    super(props);\r\n\r\n    if (process.env.NODE_ENV !== \"production\" && props.audioUrl) {\r\n      Log.info(\"Hot reload with url=\" + props.audioUrl, WaveContainer.name);\r\n      this.props.hotReloaded();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    Log.info(\r\n      \"render with props=\" + JSON.stringify(this.props),\r\n      WaveContainer.name\r\n    );\r\n\r\n    return (\r\n      <div>\r\n        {this.props.audioLoaded !== LoadingStatus.INITIALIZED && (\r\n          <CircularProgress />\r\n        )}\r\n        <WaveView url={this.props.audioUrl} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({ project }: ApplicationState) => {\r\n  return {\r\n    audioUrl: project.audioUrl,\r\n    audioLoaded: project.status\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  hotReloaded\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(WaveContainer);\r\n","import {\r\n  Divider,\r\n  FormControl,\r\n  Grid,\r\n  IconButton,\r\n  Input,\r\n  InputAdornment,\r\n  InputLabel,\r\n  NativeSelect,\r\n  Popover,\r\n  Tooltip\r\n} from \"@material-ui/core\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport LoopIcon from \"@material-ui/icons/Loop\";\r\nimport PauseIcon from \"@material-ui/icons/Pause\";\r\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\r\nimport SyncAltIcon from \"@material-ui/icons/SyncAlt\";\r\nimport TimerIcon from \"@material-ui/icons/Timer\";\r\nimport ZoomInIcon from \"@material-ui/icons/ZoomIn\";\r\nimport ZoomOutIcon from \"@material-ui/icons/ZoomOut\";\r\nimport ToggleButton from \"@material-ui/lab/ToggleButton\";\r\nimport React, { ReactElement } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport ContentLayout from \"../../components/contentLayout/contentLayout\";\r\nimport Log from \"../../components/log/log\";\r\nimport SliderInput from \"../../components/sliderInput/sliderInput\";\r\nimport View from \"../../components/view/view\";\r\nimport {\r\n  TimeSignatureType,\r\n  updatedRhythm\r\n} from \"../../states/analysis/analysisSlice\";\r\nimport {\r\n  triggeredPause,\r\n  triggeredPlay,\r\n  updatedPlaybackSettings\r\n} from \"../../states/audio/audioSlice\";\r\nimport { DialogType, openedDialog } from \"../../states/dialog/dialogsSlice\";\r\nimport {\r\n  enabledSyncFirstMeasureStart,\r\n  LoadingStatus\r\n} from \"../../states/project/projectSlice\";\r\nimport { ApplicationState } from \"../../states/store\";\r\nimport { zoomedIn, zoomedOut } from \"../../states/wave/waveSlice\";\r\nimport StructureView from \"../../views/structure/structureView\";\r\nimport StructureNavigationView from \"../../views/structureNavigation/structureNavigationView\";\r\nimport WaveContainer from \"../../views/wave/waveContainer\";\r\n\r\ninterface PropsFromState {\r\n  readonly loaded: boolean;\r\n  readonly isPlaying: boolean;\r\n  readonly syncFirstMeasureStart: boolean;\r\n  readonly firstMeasureStart: number;\r\n  readonly timeSignature: TimeSignatureType;\r\n  readonly bpm: number;\r\n  readonly detune: number;\r\n  readonly playbackRate: number;\r\n}\r\n\r\ninterface PropsFromDispatch {\r\n  zoomedIn: typeof zoomedIn;\r\n  zoomedOut: typeof zoomedOut;\r\n  triggeredPlay: typeof triggeredPlay;\r\n  triggeredPause: typeof triggeredPause;\r\n  enabledSyncFirstMeasureStart: typeof enabledSyncFirstMeasureStart;\r\n  updatedRhythm: typeof updatedRhythm;\r\n  updatedPlaybackSettings: typeof updatedPlaybackSettings;\r\n  openedDialog: typeof openedDialog;\r\n}\r\n\r\ninterface Props {}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch & Props;\r\n\r\ninterface State {\r\n  anchorEl: HTMLButtonElement | null;\r\n}\r\n\r\nclass StructurePage extends React.Component<AllProps, State> {\r\n  state: State = {\r\n    anchorEl: null\r\n  };\r\n\r\n  handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    this.setState({ anchorEl: event.currentTarget });\r\n  };\r\n\r\n  handleClose = () => {\r\n    this.setState({ anchorEl: null });\r\n  };\r\n\r\n  handleBpmChange = (e: any, bpm: number | number[]) => {\r\n    if (!Array.isArray(bpm)) {\r\n      this.props.updatedRhythm({ bpm: bpm });\r\n    }\r\n  };\r\n\r\n  handleTimeSignatureChange = (e: any) => {\r\n    this.props.updatedRhythm({ timeSignatureType: e.target.value });\r\n  };\r\n\r\n  handleDetuneChange = (e: any, detune: number | number[]) => {\r\n    if (!Array.isArray(detune) && detune !== this.props.detune) {\r\n      this.props.updatedPlaybackSettings({ detune: detune });\r\n    }\r\n  };\r\n\r\n  handlePlaybackRateChange = (e: any, playbackRate: number | number[]) => {\r\n    if (\r\n      !Array.isArray(playbackRate) &&\r\n      playbackRate !== this.props.playbackRate\r\n    ) {\r\n      this.props.updatedPlaybackSettings({ playbackRate: playbackRate });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    Log.info(\"render\", StructurePage.name);\r\n    return (\r\n      <ContentLayout\r\n        topLeft={\r\n          <View\r\n            title=\"Song Overview\"\r\n            body={\r\n              <>\r\n                <WaveContainer />\r\n                <Divider style={{ marginBottom: \"10px\" }} />\r\n                <Grid container direction=\"row\" spacing={2}>\r\n                  <Grid item xs={2}>\r\n                    <FormControl fullWidth={true}>\r\n                      <InputLabel>Start Measure 1</InputLabel>\r\n                      <Input\r\n                        type=\"text\"\r\n                        id=\"startMeasure1\"\r\n                        value={this.props.firstMeasureStart}\r\n                        startAdornment={\r\n                          <InputAdornment position=\"start\">\r\n                            <Tooltip title=\"Sync with play head\">\r\n                              <ToggleButton\r\n                                style={{ width: \"15px\", height: \"25px\" }}\r\n                                value=\"check\"\r\n                                selected={this.props.syncFirstMeasureStart}\r\n                                onChange={() => {\r\n                                  this.props.enabledSyncFirstMeasureStart(\r\n                                    !this.props.syncFirstMeasureStart\r\n                                  );\r\n                                }}\r\n                              >\r\n                                <SyncAltIcon />\r\n                              </ToggleButton>\r\n                            </Tooltip>\r\n                          </InputAdornment>\r\n                        }\r\n                      />\r\n                    </FormControl>\r\n                  </Grid>\r\n                  <Grid item xs={2}>\r\n                    <SliderInput\r\n                      title=\"Bpm\"\r\n                      value={this.props.bpm}\r\n                      min={40}\r\n                      max={220}\r\n                      step={1}\r\n                      onChange={this.handleBpmChange}\r\n                    ></SliderInput>{\" \"}\r\n                  </Grid>\r\n                  <Grid item xs={2}>\r\n                    <FormControl fullWidth={true}>\r\n                      <InputLabel>Time Signature</InputLabel>\r\n                      <NativeSelect\r\n                        value={this.props.timeSignature}\r\n                        onChange={this.handleTimeSignatureChange}\r\n                      >\r\n                        <option value={TimeSignatureType.FOUR_FOUR}>4/4</option>\r\n                        <option value={TimeSignatureType.THREE_FOUR}>\r\n                          3/4\r\n                        </option>\r\n                      </NativeSelect>\r\n                    </FormControl>{\" \"}\r\n                  </Grid>\r\n                  <Grid item xs={2}>\r\n                    <SliderInput\r\n                      title=\"Detune\"\r\n                      value={this.props.detune}\r\n                      min={-12}\r\n                      max={12}\r\n                      step={0.5}\r\n                      onChange={this.handleDetuneChange}\r\n                    ></SliderInput>{\" \"}\r\n                  </Grid>\r\n                  <Grid item xs={2}>\r\n                    <SliderInput\r\n                      title=\"Playback rate\"\r\n                      value={this.props.playbackRate}\r\n                      min={0.4}\r\n                      max={1.2}\r\n                      step={0.05}\r\n                      onChange={this.handlePlaybackRateChange}\r\n                    ></SliderInput>{\" \"}\r\n                  </Grid>\r\n                </Grid>\r\n              </>\r\n            }\r\n            action={\r\n              <>\r\n                {this.props.isPlaying ? (\r\n                  <WaveformControlButton\r\n                    title=\"Pause\"\r\n                    icon={<PauseIcon />}\r\n                    onClick={() => this.props.triggeredPause()}\r\n                  />\r\n                ) : (\r\n                  <WaveformControlButton\r\n                    title=\"Play\"\r\n                    icon={<PlayArrowIcon />}\r\n                    onClick={() => this.props.triggeredPlay()}\r\n                  />\r\n                )}\r\n\r\n                <WaveformControlButton\r\n                  title=\"Loop\"\r\n                  icon={<LoopIcon />}\r\n                  disabled={true}\r\n                />\r\n                <WaveformControlButton\r\n                  title=\"Metronome\"\r\n                  icon={<TimerIcon />}\r\n                  onClick={e => this.handleClick(e)}\r\n                  disabled={true}\r\n                />\r\n                <Popover\r\n                  style={{ height: \"400px\" }}\r\n                  open={Boolean(this.state.anchorEl)}\r\n                  anchorEl={this.state.anchorEl}\r\n                  onClose={() => this.handleClose()}\r\n                  anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\"\r\n                  }}\r\n                  transformOrigin={{\r\n                    vertical: \"top\",\r\n                    horizontal: \"left\"\r\n                  }}\r\n                >\r\n                  TODO\r\n                </Popover>\r\n                <WaveformControlButton\r\n                  title=\"Zoom in\"\r\n                  icon={<ZoomInIcon />}\r\n                  onClick={() => this.props.zoomedIn()}\r\n                />\r\n                <WaveformControlButton\r\n                  title=\"Zoom out\"\r\n                  icon={<ZoomOutIcon />}\r\n                  onClick={() => this.props.zoomedOut()}\r\n                />\r\n              </>\r\n            }\r\n          ></View>\r\n        }\r\n        topRight={\r\n          <View title=\"Song Measures\" body={<StructureNavigationView />}></View>\r\n        }\r\n        bottom={\r\n          <View\r\n            title=\"Song Structure\"\r\n            action={\r\n              <>\r\n                <WaveformControlButton\r\n                  title=\"Add section\"\r\n                  icon={<AddIcon />}\r\n                  onClick={() =>\r\n                    this.props.openedDialog(DialogType.ADD_SECTION)\r\n                  }\r\n                />\r\n              </>\r\n            }\r\n            body={<StructureView />}\r\n          ></View>\r\n        }\r\n      ></ContentLayout>\r\n    );\r\n  }\r\n}\r\n\r\nconst WaveformControlButton = (props: {\r\n  title: string;\r\n  icon: ReactElement;\r\n  disabled?: boolean;\r\n  onClick?: (e?: any) => void;\r\n}) => {\r\n  return (\r\n    <Tooltip title={props.title}>\r\n      <>\r\n        <IconButton\r\n          onClick={props.onClick}\r\n          size=\"small\"\r\n          style={{ marginTop: \"8px\", marginRight: \"5px\" }}\r\n          disabled={props.disabled}\r\n        >\r\n          {props.icon}\r\n        </IconButton>\r\n      </>\r\n    </Tooltip>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = ({ project, audio, analysis }: ApplicationState) => {\r\n  return {\r\n    loaded: project.status === LoadingStatus.INITIALIZED,\r\n    isPlaying: audio.isPlaying,\r\n    firstMeasureStart: analysis.firstMeasureStart,\r\n    syncFirstMeasureStart: project.syncFirstMeasureStart,\r\n    bpm: analysis.bpm,\r\n    timeSignature: analysis.timeSignature,\r\n    detune: audio.detune,\r\n    playbackRate: audio.playbackRate\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  zoomedIn,\r\n  zoomedOut,\r\n  triggeredPlay,\r\n  triggeredPause,\r\n  enabledSyncFirstMeasureStart,\r\n  updatedRhythm,\r\n  updatedPlaybackSettings,\r\n  openedDialog\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(StructurePage);\r\n","import React from \"react\";\r\n\r\nclass VersionInfo extends React.Component<{\r\n  version: string;\r\n  hash: string;\r\n  description: string;\r\n}> {\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.props.version} (\r\n        <a\r\n          href={\"https://github.com/tscz/transcribe/commit/\" + this.props.hash}\r\n        >\r\n          {this.props.hash} - {this.props.description}\r\n        </a>\r\n        )\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default VersionInfo;\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M339.063,60.817H228.938c-7.628,0-13.834,6.206-13.834,13.834v99.816l0,0c-4.47-2.616-9.666-4.123-15.208-4.123 c-16.658,0-30.21,13.552-30.21,30.209s13.552,30.209,30.21,30.209c16.657,0,30.209-13.552,30.209-30.209v-86.423h107.95v60.338 c-4.47-2.616-9.666-4.123-15.208-4.123c-16.657,0-30.209,13.552-30.209,30.209s13.552,30.209,30.209,30.209 s30.209-13.552,30.209-30.209V74.81l0,0C353.056,67.093,346.778,60.817,339.063,60.817z M199.896,215.759 c-8.387,0-15.209-6.822-15.209-15.208s6.822-15.208,15.209-15.208c8.385,0,15.208,6.822,15.208,15.208 S208.282,215.759,199.896,215.759z M322.848,215.759c-8.385,0-15.208-6.822-15.208-15.208s6.822-15.208,15.208-15.208 c8.386,0,15.208,6.822,15.208,15.208S331.232,215.759,322.848,215.759z M338.055,99.127H230.105V75.818h107.95v23.309H338.055z\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M254.433,317.548h-97.159c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h97.159c4.143,0,7.5-3.358,7.5-7.5 S258.577,317.548,254.433,317.548z\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M254.433,355.124h-97.159c-4.143,0-7.5,3.358-7.5,7.5c0,4.142,3.357,7.5,7.5,7.5h97.159c4.143,0,7.5-3.358,7.5-7.5 C261.934,358.482,258.577,355.124,254.433,355.124z\"\n});\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M254.433,392.698h-97.159c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h97.159c4.143,0,7.5-3.358,7.5-7.5 S258.577,392.698,254.433,392.698z\"\n});\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M387.082,317.548h-97.16c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h97.16c4.143,0,7.5-3.358,7.5-7.5 S391.226,317.548,387.082,317.548z\"\n});\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M329.632,274.728c0-4.142-3.357-7.5-7.5-7.5h-97.16c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h97.16 C326.274,282.228,329.632,278.87,329.632,274.728z\"\n});\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M387.082,355.124h-97.16c-4.143,0-7.5,3.358-7.5,7.5c0,4.142,3.357,7.5,7.5,7.5h97.16c4.143,0,7.5-3.358,7.5-7.5 C394.583,358.482,391.226,355.124,387.082,355.124z\"\n});\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M254.433,430.273h-97.159c-4.143,0-7.5,3.358-7.5,7.5c0,4.142,3.357,7.5,7.5,7.5h97.159c4.143,0,7.5-3.358,7.5-7.5 C261.934,433.631,258.577,430.273,254.433,430.273z\"\n});\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M444.04,0H289.236c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5H444.04c4.444,0,8.061,3.616,8.061,8.06v215.437 c0,4.142,3.357,7.5,7.5,7.5s7.5-3.358,7.5-7.5V23.061C467.102,10.346,456.757,0,444.04,0z\"\n});\n\nvar _ref11 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M459.602,266c-4.143,0-7.5,3.358-7.5,7.5v119.197c-4.693,0-151.358,0-162.179,0c-4.143,0-7.5,3.358-7.5,7.5 s3.357,7.5,7.5,7.5h59.335c-0.939,2.51-1.457,5.226-1.457,8.06v14.514h-57.878c-4.143,0-7.5,3.358-7.5,7.5 c0,4.142,3.357,7.5,7.5,7.5H347.8v51.725H122.344c-4.444,0-8.061-3.616-8.061-8.06V23.061c0-4.444,3.616-8.06,8.061-8.06h131.889 c4.143,0,7.5-3.358,7.5-7.5s-3.357-7.5-7.5-7.5H67.959l0,0C55.243,0,44.898,10.346,44.898,23.061v465.877 c0,12.716,10.346,23.061,23.061,23.061l0,0h287.341c0.041,0,0.08-0.005,0.12-0.006c2.005-0.033,3.861-0.87,5.184-2.191 l104.301-104.3c1.333-1.332,2.196-3.245,2.196-5.303V273.502C467.102,269.358,463.744,266,459.602,266z M100.736,496.999H67.959 c-4.444,0-8.06-3.616-8.06-8.06V23.061c0-4.444,3.615-8.06,8.06-8.06h32.777c-0.901,2.496-1.453,5.115-1.453,8.06v465.877 C99.283,491.82,99.815,494.448,100.736,496.999z M362.801,486.391v-70.632c0-4.444,3.615-8.06,8.06-8.06c7.587,0,62.354,0,70.633,0 C433.153,416.039,371.141,478.051,362.801,486.391z\"\n});\n\nvar _ref12 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref13 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref14 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref15 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref16 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref17 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref18 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref19 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref20 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref21 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref22 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref23 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref24 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref25 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar _ref26 =\n/*#__PURE__*/\nReact.createElement(\"g\", null);\n\nvar SvgLogo = function SvgLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"Capa_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512 512\",\n    style: {\n      enableBackground: \"new 0 0 512 512\"\n    },\n    xmlSpace: \"preserve\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, React.createElement(\"path\", {\n    style: {\n      fill: \"#EADCD6\"\n    },\n    d: \"M107.736,489.624V23.576c0-8.598,6.969-15.567,15.567-15.567H68.896 c-8.598,0-15.567,6.969-15.567,15.567v466.047c0,8.598,6.969,15.567,15.567,15.567h54.405 C114.704,505.191,107.736,498.221,107.736,489.624z\"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#DDCDC7\"\n    },\n    d: \"M73.331,489.624V23.576c0-8.598,6.969-15.567,15.566-15.567H68.896 c-8.598,0-15.566,6.969-15.566,15.567v466.047c0,8.598,6.969,15.567,15.566,15.567h20.001 C80.301,505.191,73.331,498.221,73.331,489.624z\"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#EADCD6\"\n    },\n    d: \"M444.015,8.01H122.202c-8.598,0-15.567,6.969-15.567,15.567v466.047 c0,8.598,6.969,15.567,15.567,15.567h233.041l104.339-104.339c0-3.762,0-370.62,0-377.275C459.582,14.98,452.612,8.01,444.015,8.01z \"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#DDCDC7\"\n    },\n    d: \"M127.051,489.624V23.577c0-8.598,6.969-15.567,15.567-15.567h-20.415 c-8.597,0-15.566,6.969-15.566,15.567v466.047c0,8.598,6.969,15.567,15.566,15.567h20.415 C134.02,505.191,127.051,498.221,127.051,489.624z\"\n  }), React.createElement(\"g\", null, React.createElement(\"path\", {\n    style: {\n      fill: \"#F8BF00\"\n    },\n    d: \"M353.931,107.32H230.98V75.342c0-3.498,2.836-6.333,6.333-6.333h110.125 c3.586,0,6.492,2.907,6.492,6.492v31.819H353.931z\"\n  }), React.createElement(\"circle\", {\n    style: {\n      fill: \"#F8BF00\"\n    },\n    cx: 201.212,\n    cy: 201.242,\n    r: 22.708\n  }), React.createElement(\"circle\", {\n    style: {\n      fill: \"#F8BF00\"\n    },\n    cx: 331.22,\n    cy: 201.242,\n    r: 22.708\n  })), React.createElement(\"g\", null, React.createElement(\"path\", {\n    style: {\n      fill: \"#EFA603\"\n    },\n    d: \"M257.315,69.008h-20.001c-3.498,0-6.333,2.836-6.333,6.333v31.977h20.001V75.342 C250.981,71.844,253.817,69.008,257.315,69.008z\"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#EFA603\"\n    },\n    d: \"M198.503,201.242c0-8.952,5.181-16.691,12.708-20.389c-3.018-1.483-6.411-2.319-10.001-2.319 c-12.542,0-22.708,10.167-22.708,22.708c0,12.542,10.167,22.708,22.708,22.708c3.589,0,6.982-0.836,10.001-2.319 C203.685,217.933,198.503,210.195,198.503,201.242z\"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#EFA603\"\n    },\n    d: \"M328.516,201.242c0-8.952,5.181-16.691,12.708-20.389c-3.018-1.483-6.411-2.319-10.001-2.319 c-12.542,0-22.708,10.167-22.708,22.708c0,12.542,10.167,22.708,22.708,22.708c3.589,0,6.982-0.836,10.001-2.319 C333.697,217.933,328.516,210.195,328.516,201.242z\"\n  })), React.createElement(\"path\", {\n    style: {\n      fill: \"#DDCDC7\"\n    },\n    d: \"M459.582,400.852h-88.772c-8.598,0-15.567,6.969-15.567,15.567v88.772L459.582,400.852z\"\n  }), React.createElement(\"path\", {\n    style: {\n      fill: \"#C9BCB8\"\n    },\n    d: \"M375.245,416.418c0-8.598,6.969-15.567,15.567-15.567H370.81c-8.598,0-15.567,6.969-15.567,15.567 v88.772l20.001-20.001V416.418z\"\n  }), _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10, _ref11, _ref12, _ref13, _ref14, _ref15, _ref16, _ref17, _ref18, _ref19, _ref20, _ref21, _ref22, _ref23, _ref24, _ref25, _ref26);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logo.dd187a77.svg\";\nexport { ForwardRef as ReactComponent };","import { Grid } from \"@material-ui/core\";\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Button from \"@material-ui/core/Button\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport { Theme, WithStyles, withStyles } from \"@material-ui/core/styles\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport AlbumIcon from \"@material-ui/icons/Album\";\nimport HomeIcon from \"@material-ui/icons/Home\";\nimport MusicVideoIcon from \"@material-ui/icons/MusicVideo\";\nimport PrintIcon from \"@material-ui/icons/Print\";\nimport RadioIcon from \"@material-ui/icons/Radio\";\nimport React from \"react\";\nimport { FunctionComponent } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport DefaultPage from \"../../pages/default/defaultPage\";\nimport DrumPage from \"../../pages/drum/drumPage\";\nimport GuitarPage from \"../../pages/guitar/guitarPage\";\nimport HarmonyPage from \"../../pages/harmony/harmonyPage\";\nimport PrintPage from \"../../pages/print/printPage\";\nimport StructurePage from \"../../pages/structure/structurePage\";\nimport { DialogType, openedDialog } from \"../../states/dialog/dialogsSlice\";\nimport { LoadingStatus } from \"../../states/project/projectSlice\";\nimport { Page, switchedPage } from \"../../states/project/projectSlice\";\nimport { ApplicationState } from \"../../states/store\";\nimport { stylesForApp } from \"../../styles/styles\";\nimport Log from \"../log/log\";\nimport VersionInfo from \"../versionInfo/versionInfo\";\nimport { ReactComponent as Logo } from \"./logo.svg\";\n\ninterface PropsFromState {\n  currentPage: Page;\n  status: LoadingStatus;\n  title: string;\n}\n\ninterface PropsFromDispatch {\n  switchedPage: typeof switchedPage;\n  openedDialog: typeof openedDialog;\n}\n\ninterface Props extends WithStyles<typeof stylesForApp> {\n  theme: Theme;\n}\n\ntype AllProps = Props & PropsFromState & PropsFromDispatch;\n\nclass App extends React.Component<AllProps> {\n  render() {\n    Log.info(\"render\", App.name);\n    return (\n      <>\n        <div className={this.props.classes.root}>\n          <AppBar position=\"fixed\" className={this.props.classes.appBar}>\n            <Toolbar>\n              <Logo height=\"40px\" style={{ marginRight: \"5px\" }}></Logo>\n              <Typography color=\"textPrimary\" variant=\"h4\" noWrap>\n                Transcribe\n              </Typography>\n              <Typography\n                color=\"textPrimary\"\n                variant=\"caption\"\n                noWrap\n                className={this.props.classes.title}\n              >\n                [{this.props.title !== \"\" ? this.props.title : \"no file loaded\"}\n                ]\n              </Typography>\n              <Button\n                onClick={() => this.props.openedDialog(DialogType.NEW)}\n                disabled={this.props.status === LoadingStatus.INITIALIZING}\n              >\n                New\n              </Button>\n              <Button\n                onClick={() => this.props.openedDialog(DialogType.OPEN)}\n                disabled={this.props.status === LoadingStatus.INITIALIZING}\n              >\n                Open\n              </Button>\n              <Button\n                onClick={() => this.props.openedDialog(DialogType.SAVE)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                Save\n              </Button>\n            </Toolbar>\n          </AppBar>\n          <Drawer\n            className={this.props.classes.drawer}\n            variant=\"permanent\"\n            classes={{\n              paper: this.props.classes.drawerPaper\n            }}\n          >\n            <div className={this.props.classes.toolbar} />\n            <List style={{ color: \"#abb1b7\" }}>\n              <ListItem\n                button\n                key=\"Structure\"\n                onClick={() => this.props.switchedPage(Page.STRUCTURE)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                <ListItemIcon style={{ color: \"#abb1b7\" }}>\n                  <HomeIcon />\n                </ListItemIcon>\n                <ListItemText primary=\"Structure\" />\n              </ListItem>\n              <ListItem\n                button\n                key=\"Harmony\"\n                onClick={() => this.props.switchedPage(Page.HARMONY)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                <ListItemIcon style={{ color: \"#abb1b7\" }}>\n                  <MusicVideoIcon />\n                </ListItemIcon>\n                <ListItemText primary=\"Harmony\" />\n              </ListItem>\n              <ListItem\n                button\n                key=\"Guitar\"\n                onClick={() => this.props.switchedPage(Page.GUITAR)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                <ListItemIcon style={{ color: \"#abb1b7\" }}>\n                  <RadioIcon />\n                </ListItemIcon>\n                <ListItemText primary=\"Guitar\" />\n              </ListItem>\n              <ListItem\n                button\n                key=\"Drum\"\n                onClick={() => this.props.switchedPage(Page.DRUM)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                <ListItemIcon style={{ color: \"#abb1b7\" }}>\n                  <AlbumIcon />\n                </ListItemIcon>\n                <ListItemText primary=\"Drum\" />\n              </ListItem>\n              <ListItem\n                button\n                key=\"Print\"\n                onClick={() => this.props.switchedPage(Page.PRINT)}\n                disabled={this.props.status !== LoadingStatus.INITIALIZED}\n              >\n                <ListItemIcon style={{ color: \"#abb1b7\" }}>\n                  <PrintIcon />\n                </ListItemIcon>\n                <ListItemText primary=\"Print\" />\n              </ListItem>\n            </List>\n          </Drawer>\n          <main className={this.props.classes.content}>\n            <div className={this.props.classes.toolbar} />\n            <Toggle show={this.props.currentPage === Page.DEFAULT}>\n              <DefaultPage />\n            </Toggle>\n            <Toggle show={this.props.currentPage === Page.STRUCTURE}>\n              <StructurePage />\n            </Toggle>\n            <Toggle show={this.props.currentPage === Page.HARMONY}>\n              <HarmonyPage />\n            </Toggle>\n            <Toggle show={this.props.currentPage === Page.GUITAR}>\n              <GuitarPage />\n            </Toggle>\n            <Toggle show={this.props.currentPage === Page.DRUM}>\n              <DrumPage />\n            </Toggle>\n            <Toggle show={this.props.currentPage === Page.PRINT}>\n              <PrintPage />\n            </Toggle>\n            <Grid\n              container\n              direction=\"column\"\n              justify=\"flex-end\"\n              alignItems=\"flex-end\"\n              style={{ marginTop: \"20px\" }}\n            >\n              <Grid item>\n                App version:{\" \"}\n                <VersionInfo\n                  version={process.env.REACT_APP_VERSION ?? \"\"}\n                  hash={process.env.REACT_APP_VERSION_HASH ?? \"\"}\n                  description={process.env.REACT_APP_VERSION_DESCRIPTION ?? \"\"}\n                />\n              </Grid>\n            </Grid>\n          </main>\n        </div>\n      </>\n    );\n  }\n}\n\nconst Toggle: FunctionComponent<{ show: boolean }> = props => {\n  if (props.show) {\n    return <div style={{ display: \"inline\" }}>{props.children}</div>;\n  } else {\n    return <div style={{ display: \"none\" }}>{props.children}</div>;\n  }\n};\n\nconst mapStateToProps = ({ project }: ApplicationState) => {\n  return {\n    currentPage: project.currentPage,\n    status: project.status,\n    title: project.title\n  };\n};\n\nconst mapDispatchToProps = {\n  switchedPage,\n  openedDialog\n};\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(withStyles(stylesForApp, { withTheme: true })(App));\n","import { createStyles, Theme } from \"@material-ui/core/styles\";\r\n\r\nconst drawerWidth = 190;\r\n\r\nexport const stylesForApp = (theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      display: \"flex\",\r\n      backgroundColor: \"#d5d8da\"\r\n    },\r\n    appBar: {\r\n      zIndex: theme.zIndex.drawer + 1,\r\n      backgroundColor: \"#FFFFFF\"\r\n    },\r\n    drawer: {\r\n      width: drawerWidth,\r\n      flexShrink: 0\r\n    },\r\n    drawerPaper: {\r\n      width: drawerWidth,\r\n      backgroundColor: \"#202a2f\"\r\n    },\r\n    content: {\r\n      flexGrow: 1,\r\n      padding: theme.spacing(3)\r\n    },\r\n    toolbar: theme.mixins.toolbar,\r\n    title: {\r\n      flexGrow: 1,\r\n      marginLeft: \"50px\"\r\n    }\r\n  });\r\n","import { saveAs } from \"file-saver\";\r\nimport JSZip from \"jszip\";\r\n\r\nimport { PersistedState } from \"../states/store\";\r\n\r\ninterface SaveOptions {\r\n  audioFileUrl: string;\r\n  state: PersistedState;\r\n}\r\n\r\nclass PersistenceApi {\r\n  private constructor() {}\r\n\r\n  private static songFile = \"song.blob\";\r\n  private static stateFile = \"state.json\";\r\n\r\n  static save = async (filename: string, options: SaveOptions) => {\r\n    let zip = new JSZip();\r\n    zip.file(PersistenceApi.stateFile, JSON.stringify(options.state));\r\n\r\n    let response = await fetch(options.audioFileUrl);\r\n    let audioBlob: Blob = await response.blob();\r\n    zip.file(PersistenceApi.songFile, audioBlob);\r\n\r\n    await zip.generateAsync({ type: \"blob\" }).then(file => {\r\n      saveAs(file, filename);\r\n    });\r\n  };\r\n\r\n  static async open(\r\n    zip: File\r\n  ): Promise<{ audioBlob: Blob; state: PersistedState }> {\r\n    let archive = await JSZip.loadAsync(zip);\r\n    let audioBlob = await archive.file(PersistenceApi.songFile).async(\"blob\");\r\n\r\n    let json = await archive.file(PersistenceApi.stateFile).async(\"text\");\r\n    let state: PersistedState = JSON.parse(json);\r\n\r\n    return { audioBlob, state };\r\n  }\r\n\r\n  static revokeLocalFile(url: string) {\r\n    window.URL.revokeObjectURL(url);\r\n  }\r\n\r\n  static getLocalFileUrl(blob: Blob) {\r\n    return window.URL.createObjectURL(blob);\r\n  }\r\n}\r\n\r\nexport default PersistenceApi;\r\n","import {\r\n  createStyles,\r\n  InputBase,\r\n  Theme,\r\n  WithStyles,\r\n  withStyles\r\n} from \"@material-ui/core\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport MenuIcon from \"@material-ui/icons/OpenInBrowser\";\r\nimport React from \"react\";\r\n\r\nimport PersistenceApi from \"../../api/persistenceApi\";\r\n\r\nexport enum FileType {\r\n  AUDIO = \"audio/*\",\r\n  ZIP = \".zip\"\r\n}\r\n\r\nconst toString = (type: FileType) => {\r\n  switch (type) {\r\n    case FileType.AUDIO:\r\n      return \"Audio File\";\r\n    case FileType.ZIP:\r\n      return \"Project Zip File\";\r\n  }\r\n};\r\n\r\ninterface Props extends WithStyles<typeof stylesForFileInput> {\r\n  id: string;\r\n  fileType: FileType;\r\n  callback: (file: File, fileUrl: string) => void;\r\n}\r\n\r\ninterface State {\r\n  display: string;\r\n}\r\n\r\nconst stylesForFileInput = (theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      padding: \"4px 0px\",\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      width: \"100%\"\r\n    },\r\n    input: {\r\n      marginLeft: theme.spacing(1),\r\n      flex: 1\r\n    },\r\n    iconButton: {\r\n      padding: 10\r\n    }\r\n  });\r\n\r\nclass FileInput extends React.Component<Props, State> {\r\n  state: State = {\r\n    display: \"\"\r\n  };\r\n\r\n  fileInput: React.RefObject<HTMLInputElement>;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.fileInput = React.createRef();\r\n  }\r\n\r\n  handleChange = (fileList: FileList | null) => {\r\n    if (fileList === null) return;\r\n\r\n    var file = fileList[0];\r\n    var fileURL = PersistenceApi.getLocalFileUrl(file);\r\n\r\n    this.setState({ display: file.name });\r\n    this.props.callback(file, fileURL);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Paper component=\"form\" className={this.props.classes.root}>\r\n          <InputBase\r\n            className={this.props.classes.input}\r\n            placeholder={\"Choose \" + toString(this.props.fileType) + \" ...\"}\r\n            inputProps={{\r\n              \"aria-label\": \"Choose \" + toString(this.props.fileType)\r\n            }}\r\n            value={this.state.display}\r\n            readOnly={true}\r\n            onClick={() => this.fileInput.current?.click()}\r\n          />\r\n          <IconButton\r\n            aria-label=\"menu\"\r\n            onClick={() => this.fileInput.current?.click()}\r\n            className={this.props.classes.iconButton}\r\n          >\r\n            <MenuIcon />{\" \"}\r\n          </IconButton>\r\n        </Paper>\r\n        <input\r\n          hidden={true}\r\n          id={this.props.id}\r\n          type=\"file\"\r\n          accept={this.props.fileType}\r\n          ref={this.fileInput}\r\n          onChange={e => this.handleChange(e.target.files)}\r\n        ></input>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withStyles(stylesForFileInput, { withTheme: true })(FileInput);\r\n","import { PeaksInstance } from \"peaks.js\";\r\nimport Tone from \"tone\";\r\n\r\ninterface Player {\r\n  destroy: () => void;\r\n  play: () => void;\r\n  pause: () => void;\r\n  isPlaying: () => boolean;\r\n  isSeeking: () => boolean;\r\n  getCurrentTime: () => number;\r\n  getDuration: () => number;\r\n  seek: (time: number) => void;\r\n  setPlaybackRate: (playbackRate: number) => void;\r\n  setDetune: (pitch: number) => void;\r\n}\r\n\r\ninterface EmitAware {\r\n  emit: (id: string, value: any) => void;\r\n}\r\n\r\nexport interface PeaksInstanceEmitAware extends PeaksInstance, EmitAware {}\r\n\r\n/**\r\n * Tone.js Player replacement for the <audio>-element based Peaks.js player\r\n */\r\nclass AudioPlayer implements Player {\r\n  peaks: PeaksInstanceEmitAware;\r\n  player: Tone.Player;\r\n  pitchShift: Tone.PitchShift;\r\n  detune: number;\r\n\r\n  constructor(\r\n    peaks: PeaksInstance,\r\n    audioBuffer: AudioBuffer,\r\n    onSongComplete: () => void\r\n  ) {\r\n    this.peaks = peaks as PeaksInstanceEmitAware;\r\n\r\n    this.player = new Tone.Player(audioBuffer);\r\n    this.player.sync();\r\n    this.player.start();\r\n\r\n    this.pitchShift = new Tone.PitchShift();\r\n    this.detune = 0;\r\n\r\n    Tone.connectSeries(this.player, this.pitchShift, Tone.Master);\r\n\r\n    Tone.Transport.scheduleRepeat(time => {\r\n      this.peaks.emit(\"player_time_update\", this.getCurrentTime());\r\n      if (this.getCurrentTime() >= this.getDuration()) {\r\n        Tone.Transport.stop();\r\n        onSongComplete();\r\n      }\r\n    }, 0.03);\r\n\r\n    this.peaks.emit(\"player_canplay\", this);\r\n  }\r\n\r\n  shiftToSemitones = (shift: number) => 12 * Math.log2(1 / shift);\r\n\r\n  setPlaybackRate(playbackRate: number) {\r\n    this.player.playbackRate = playbackRate;\r\n\r\n    // Detune to keep consistent pitch, even if the playback speed changed\r\n    this.setDetune(this.detune);\r\n\r\n    // Adjust playback to new playbackrate\r\n    if (this.isPlaying()) {\r\n      this.seek(this.getCurrentTime());\r\n    }\r\n  }\r\n\r\n  setDetune(detune: number) {\r\n    this.detune = detune;\r\n\r\n    this.pitchShift.pitch =\r\n      this.shiftToSemitones(this.player.playbackRate) + detune;\r\n  }\r\n\r\n  destroy = () => {\r\n    Tone.context.dispose();\r\n    ((Tone as unknown) as Tone & {\r\n      setContext: (ctx: AudioContext) => void;\r\n    }).setContext(new AudioContext());\r\n  };\r\n\r\n  play = () => {\r\n    Tone.Transport.start(\r\n      Tone.now(),\r\n      this.getCurrentTime() / this.player.playbackRate\r\n    );\r\n    this.peaks.emit(\r\n      \"player_play\",\r\n      this.getCurrentTime() / this.player.playbackRate\r\n    );\r\n  };\r\n\r\n  pause = () => {\r\n    Tone.Transport.pause();\r\n    this.peaks.emit(\"player_pause\", this.getCurrentTime());\r\n  };\r\n\r\n  isPlaying = () => {\r\n    return Tone.Transport.state === \"started\";\r\n  };\r\n\r\n  isSeeking = () => {\r\n    return false;\r\n  };\r\n\r\n  getCurrentTime = () => {\r\n    return (\r\n      this.player.buffer.toSeconds(Tone.Transport.position) *\r\n      this.player.playbackRate\r\n    );\r\n  };\r\n\r\n  getDuration = () => {\r\n    return this.player.buffer.duration;\r\n  };\r\n\r\n  seek = (time: number) => {\r\n    const normalizedTime = time / this.player.playbackRate;\r\n\r\n    Tone.Transport.seconds = normalizedTime;\r\n\r\n    this.peaks.emit(\"player_time_update\", time);\r\n    this.peaks.emit(\"player_seek\", time);\r\n  };\r\n}\r\n\r\nexport default AudioPlayer;\r\n","import Peaks, { PeaksInstance } from \"peaks.js\";\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport Tone from \"tone\";\r\n\r\nimport PersistenceApi from \"../../api/persistenceApi\";\r\nimport {\r\n  Measure,\r\n  Section,\r\n  updatedRhythm\r\n} from \"../../states/analysis/analysisSlice\";\r\nimport { triggeredPause } from \"../../states/audio/audioSlice\";\r\nimport {\r\n  initializedProject,\r\n  LoadingStatus\r\n} from \"../../states/project/projectSlice\";\r\nimport { ApplicationState, NormalizedObjects } from \"../../states/store\";\r\nimport Log from \"../log/log\";\r\nimport AudioPlayer from \"./audioPlayer\";\r\nimport PeaksConfig, {\r\n  AUDIO_DOM_ELEMENT,\r\n  ZOOMVIEW_CONTAINER\r\n} from \"./peaksConfig\";\r\n\r\ninterface PropsFromState {\r\n  audioUrl: string;\r\n  status: LoadingStatus;\r\n  sections: NormalizedObjects<Section>;\r\n  measures: NormalizedObjects<Measure>;\r\n  zoomLevel: number;\r\n  syncFirstMeasureStart: boolean;\r\n  isPlaying: boolean;\r\n  detune: number;\r\n  playbackRate: number;\r\n  secondsPerMeasure: number;\r\n  audioSampleRate: number;\r\n}\r\n\r\ninterface PropsFromDispatch {\r\n  initializedProject: typeof initializedProject;\r\n  updatedRhythm: typeof updatedRhythm;\r\n  triggeredPause: typeof triggeredPause;\r\n}\r\n\r\ninterface Props {}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch & Props;\r\n\r\nclass AudioManagement extends React.Component<AllProps> {\r\n  peaks: Peaks.PeaksInstance | undefined;\r\n  player: AudioPlayer | undefined;\r\n\r\n  private getPeaks = () => this.peaks;\r\n  private getPlayer = () => this.player;\r\n\r\n  componentDidUpdate(prevProps: AllProps) {\r\n    Log.info(\r\n      \"componentDidUpdate with status \" +\r\n        prevProps.status +\r\n        \" -> \" +\r\n        this.props.status,\r\n      AudioManagement.name\r\n    );\r\n\r\n    // Early return if there is no audio file initialized yet.\r\n    if (this.props.status === LoadingStatus.NOT_INITIALIZED) return;\r\n\r\n    // Early return if an initialization is still in progress\r\n    if (\r\n      prevProps.status === this.props.status &&\r\n      this.props.status === LoadingStatus.INITIALIZING\r\n    )\r\n      return;\r\n\r\n    // Initialize audio management if status changed to init\r\n    if (\r\n      prevProps.status !== this.props.status &&\r\n      this.props.status === LoadingStatus.INITIALIZING\r\n    ) {\r\n      Log.info(\"initialize audio engine\", AudioManagement.name);\r\n      if (prevProps.audioUrl !== this.props.audioUrl) {\r\n        Log.info(\r\n          \"switch from \" + prevProps.audioUrl + \" to \" + this.props.audioUrl,\r\n          AudioManagement.name\r\n        );\r\n        PersistenceApi.revokeLocalFile(prevProps.audioUrl);\r\n      }\r\n      this.init();\r\n      return;\r\n    }\r\n\r\n    if (\r\n      prevProps.status !== this.props.status &&\r\n      this.props.status === LoadingStatus.INITIALIZED\r\n    ) {\r\n      this.recomputeZoomlevels(\r\n        this.props.secondsPerMeasure,\r\n        this.props.audioSampleRate,\r\n        this.props.measures.allIds.length\r\n      );\r\n      this.repaintWaveform(\r\n        this.props.sections,\r\n        this.props.measures,\r\n        this.props.zoomLevel,\r\n        this.props.secondsPerMeasure\r\n      );\r\n    }\r\n\r\n    if (\r\n      prevProps.secondsPerMeasure !== this.props.secondsPerMeasure ||\r\n      prevProps.audioSampleRate !== this.props.audioSampleRate ||\r\n      prevProps.measures.allIds.length !== this.props.measures.allIds.length\r\n    ) {\r\n      this.recomputeZoomlevels(\r\n        this.props.secondsPerMeasure,\r\n        this.props.audioSampleRate,\r\n        this.props.measures.allIds.length\r\n      );\r\n    }\r\n\r\n    if (\r\n      prevProps.sections !== this.props.sections ||\r\n      prevProps.measures !== this.props.measures ||\r\n      prevProps.zoomLevel !== this.props.zoomLevel\r\n    ) {\r\n      this.repaintWaveform(\r\n        this.props.sections,\r\n        this.props.measures,\r\n        this.props.zoomLevel,\r\n        this.props.secondsPerMeasure\r\n      );\r\n    }\r\n\r\n    if (prevProps.playbackRate !== this.props.playbackRate) {\r\n      this.getPlayer()?.setPlaybackRate(this.props.playbackRate);\r\n    }\r\n\r\n    if (prevProps.detune !== this.props.detune) {\r\n      this.getPlayer()?.setDetune(this.props.detune);\r\n    }\r\n\r\n    if (prevProps.isPlaying !== this.props.isPlaying) {\r\n      if (this.props.isPlaying) {\r\n        this.getPlayer()?.play();\r\n      } else {\r\n        this.getPlayer()?.pause();\r\n      }\r\n    }\r\n  }\r\n\r\n  private recomputeZoomlevels(\r\n    secondsPerMeasure: number,\r\n    audioSampleRate: number,\r\n    measuresCount: number\r\n  ) {\r\n    let newZoomLevels = PeaksConfig.computeZoomLevels(\r\n      secondsPerMeasure,\r\n      audioSampleRate,\r\n      document.getElementById(ZOOMVIEW_CONTAINER)!.clientWidth,\r\n      measuresCount\r\n    );\r\n\r\n    //TODO: Used any because setZoomlevel is not API. See https://github.com/bbc/peaks.js/issues/295.\r\n    (this.getPeaks()?.zoom as any).setZoomLevels(newZoomLevels);\r\n  }\r\n\r\n  private repaintWaveform(\r\n    sections: NormalizedObjects<Section>,\r\n    measures: NormalizedObjects<Measure>,\r\n    zoomLevel: number,\r\n    timePerMeasure: number\r\n  ) {\r\n    this.getPeaks()?.segments.removeAll();\r\n    this.getPeaks()?.segments.add(\r\n      PeaksConfig.sectionsToSegment(sections, measures, timePerMeasure)\r\n    );\r\n    this.getPeaks()?.points.removeAll();\r\n    this.getPeaks()?.points.add(PeaksConfig.measuresToPoints(measures));\r\n    this.getPeaks()?.zoom.setZoom(zoomLevel);\r\n  }\r\n\r\n  private init = () => {\r\n    const audioCtx: AudioContext = (Tone.context as unknown) as AudioContext;\r\n\r\n    this.getPeaks()?.destroy();\r\n\r\n    let audio = this;\r\n\r\n    // Load audioFile into audio buffer\r\n    fetch(this.props.audioUrl)\r\n      .then(function(response) {\r\n        return response.arrayBuffer();\r\n      })\r\n      .then(function(buffer) {\r\n        return audioCtx.decodeAudioData(buffer);\r\n      })\r\n      .then(function(audioBuffer) {\r\n        audio.initPeaks(audioBuffer);\r\n      });\r\n  };\r\n\r\n  private initPeaks(audioBuffer: AudioBuffer) {\r\n    Log.info(\"init peaks\", AudioManagement.name);\r\n\r\n    Peaks.init(PeaksConfig.create(audioBuffer), (err, peaks) => {\r\n      if (err) throw err;\r\n      if (peaks === undefined)\r\n        throw new Error(\"Peaks instance is not correctly initialized.\");\r\n\r\n      initPlayer(peaks, audioBuffer);\r\n      replacePlayer(peaks, audioBuffer);\r\n\r\n      peaks.on(\"player_seek\", (time: number) => {\r\n        if (this.props.syncFirstMeasureStart)\r\n          this.props.updatedRhythm({ firstMeasureStart: time });\r\n      });\r\n\r\n      this.peaks = peaks;\r\n\r\n      this.props.initializedProject({\r\n        audioDuration: audioBuffer.duration,\r\n        audioSampleRate: audioBuffer.sampleRate\r\n      });\r\n    });\r\n\r\n    let initPlayer = (peaks: Peaks.PeaksInstance, audioBuffer: AudioBuffer) => {\r\n      this.player = new AudioPlayer(peaks, audioBuffer, () =>\r\n        this.props.triggeredPause()\r\n      );\r\n    };\r\n\r\n    let replacePlayer = (\r\n      peaks: Peaks.PeaksInstance,\r\n      audioBuffer: AudioBuffer\r\n    ) => {\r\n      (peaks.player as any).destroy();\r\n      peaks.player = (this.player as unknown) as PeaksInstance[\"player\"];\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <audio id={AUDIO_DOM_ELEMENT} controls hidden>\r\n        {this.props.audioUrl ? (\r\n          <source src={this.props.audioUrl} type=\"audio/mpeg\" />\r\n        ) : null}\r\n        Your browser does not support the audio element.\r\n      </audio>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = ({\r\n  project,\r\n  analysis,\r\n  audio,\r\n  wave\r\n}: ApplicationState) => {\r\n  return {\r\n    audioUrl: project.audioUrl,\r\n    sections: analysis.sections,\r\n    measures: analysis.measures,\r\n    zoomLevel: wave.zoom,\r\n    status: project.status,\r\n    syncFirstMeasureStart: project.syncFirstMeasureStart,\r\n    isPlaying: audio.isPlaying,\r\n    detune: audio.detune,\r\n    playbackRate: audio.playbackRate,\r\n    secondsPerMeasure:\r\n      analysis.measures.byId[\"1\"]?.time - analysis.measures.byId[\"0\"]?.time,\r\n    audioSampleRate: analysis.audioSampleRate\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  initializedProject,\r\n  updatedRhythm,\r\n  triggeredPause\r\n};\r\nexport default connect(mapStateToProps, mapDispatchToProps)(AudioManagement);\r\n","import { configureStore, createAction } from \"@reduxjs/toolkit\";\r\nimport { AnyAction, combineReducers, Reducer } from \"redux\";\r\n\r\nimport analysisReducer, { AnalysisState } from \"./analysis/analysisSlice\";\r\nimport audioReducer, { AudioState } from \"./audio/audioSlice\";\r\nimport dialogReducer, { DialogState } from \"./dialog/dialogsSlice\";\r\nimport projectReducer, { ProjectState } from \"./project/projectSlice\";\r\nimport waveReducer, { WaveState } from \"./wave/waveSlice\";\r\n\r\n/** The top-level application state object. */\r\nexport interface ApplicationState {\r\n  analysis: AnalysisState;\r\n  audio: AudioState;\r\n  dialog: DialogState;\r\n  project: ProjectState;\r\n  wave: WaveState;\r\n}\r\n\r\nexport interface PersistedState {\r\n  analysis: AnalysisState;\r\n  project: ProjectState;\r\n}\r\n\r\nexport interface NormalizedObjects<T> {\r\n  byId: { [id: string]: T };\r\n  allIds: string[];\r\n}\r\n\r\nexport const restoredPersistedState = createAction<PersistedState>(\r\n  \"restoredPersistedState\"\r\n);\r\n\r\nexport const createRootReducer: Reducer<ApplicationState, AnyAction> = (\r\n  state,\r\n  action\r\n) => {\r\n  state = sliceReducer(state, action);\r\n\r\n  if (restoredPersistedState.match(action)) {\r\n    return state;\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const sliceReducer = combineReducers({\r\n  analysis: analysisReducer,\r\n  audio: audioReducer,\r\n  dialog: dialogReducer,\r\n  project: projectReducer,\r\n  wave: waveReducer\r\n});\r\n\r\nconst createAppStore = () => {\r\n  const store = configureStore({\r\n    reducer: createRootReducer,\r\n    preloadedState: undefined\r\n  });\r\n\r\n  if (process.env.NODE_ENV !== \"production\" && module.hot) {\r\n    module.hot.accept(\"./store\", () => store.replaceReducer(createRootReducer));\r\n  }\r\n  return store;\r\n};\r\n\r\nexport default createAppStore();\r\n","import {\r\n  DialogActions,\r\n  DialogContent,\r\n  DialogContentText\r\n} from \"@material-ui/core\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport { Component } from \"react\";\r\nimport React from \"react\";\r\n\r\nexport interface DialogAction {\r\n  label: string;\r\n  onClick: () => void;\r\n  disabled?: boolean;\r\n}\r\n\r\ninterface ModalDialogProps {\r\n  title: string;\r\n  subTitle?: string;\r\n  onCancel: () => void;\r\n  actions?: DialogAction[];\r\n}\r\n\r\nclass ModalDialog extends Component<ModalDialogProps> {\r\n  render() {\r\n    return (\r\n      <Dialog\r\n        onClose={this.props.onCancel}\r\n        open={true}\r\n        fullWidth={true}\r\n        maxWidth={\"sm\"}\r\n      >\r\n        <DialogTitle>{this.props.title}</DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText>{this.props.subTitle}</DialogContentText>\r\n          {this.props.children}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          {this.props.actions?.map((value, index) => (\r\n            <Button\r\n              key={value.label}\r\n              onClick={value.onClick}\r\n              color=\"primary\"\r\n              disabled={value.disabled ?? false}\r\n            >\r\n              {value.label}\r\n            </Button>\r\n          ))}\r\n        </DialogActions>\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ModalDialog;\r\n","import { FormLabel } from \"@material-ui/core\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport React, { Component, FunctionComponent, useState } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport PersistenceApi from \"../../api/persistenceApi\";\r\nimport {\r\n  addedSection,\r\n  initialAnalysisState,\r\n  SectionType\r\n} from \"../../states/analysis/analysisSlice\";\r\nimport { closedDialog, DialogType } from \"../../states/dialog/dialogsSlice\";\r\nimport {\r\n  createdProject,\r\n  initialProjectState,\r\n  Page,\r\n  switchedPage\r\n} from \"../../states/project/projectSlice\";\r\nimport store, { ApplicationState } from \"../../states/store\";\r\nimport ArrayUtil from \"../../util/ArrayUtil\";\r\nimport FileInput, { FileType } from \"../fileInput/fileInput\";\r\nimport MeasureSelect from \"../measureSelect/measureSelect\";\r\nimport ModalDialog, { DialogAction } from \"../modalDialog/modalDialog\";\r\nimport SectionSelect from \"../sectionSelect/sectionSelect\";\r\n\r\ninterface PropsFromState {\r\n  type: DialogType;\r\n  audioUrl: string;\r\n  maxMeasure: number;\r\n}\r\n\r\ninterface PropsFromDispatch {\r\n  switchedPage: typeof switchedPage;\r\n  closedDialog: typeof closedDialog;\r\n  createdProject: typeof createdProject;\r\n  addedSection: typeof addedSection;\r\n}\r\n\r\ntype AllProps = PropsFromState & PropsFromDispatch;\r\n\r\nclass DialogManagement extends Component<AllProps> {\r\n  render() {\r\n    switch (this.props.type) {\r\n      case DialogType.NONE:\r\n        return null;\r\n      case DialogType.NEW:\r\n        return (\r\n          <NewDialog\r\n            onCancel={() => this.props.closedDialog()}\r\n            onSubmit={(title: string, audioUrl: string) => {\r\n              this.props.createdProject({\r\n                analysis: initialAnalysisState,\r\n                project: { ...initialProjectState, audioUrl, title }\r\n              });\r\n              this.props.switchedPage(Page.STRUCTURE);\r\n              this.props.closedDialog();\r\n            }}\r\n          ></NewDialog>\r\n        );\r\n      case DialogType.OPEN:\r\n        return (\r\n          <OpenDialog\r\n            onCancel={() => this.props.closedDialog()}\r\n            onSubmit={(zip: File, zipUrl: string) => {\r\n              PersistenceApi.open(zip).then(({ audioBlob, state }) => {\r\n                let audioUrl = PersistenceApi.getLocalFileUrl(audioBlob);\r\n                PersistenceApi.revokeLocalFile(zipUrl);\r\n\r\n                this.props.createdProject({\r\n                  analysis: state.analysis,\r\n                  project: { ...state.project, audioUrl }\r\n                });\r\n                this.props.switchedPage(Page.STRUCTURE);\r\n                this.props.closedDialog();\r\n              });\r\n            }}\r\n          ></OpenDialog>\r\n        );\r\n      case DialogType.SAVE:\r\n        return (\r\n          <ModalDialog\r\n            title=\"Save Transcription\"\r\n            subTitle=\"Please click on 'save' to generate a transcription.zip file. It contains the transcription and the source audio file.\"\r\n            onCancel={() => this.props.closedDialog()}\r\n            actions={[\r\n              {\r\n                label: \"Cancel\",\r\n                onClick: () => this.props.closedDialog()\r\n              },\r\n              {\r\n                label: \"Save\",\r\n                onClick: () => {\r\n                  PersistenceApi.save(\"transcription.zip\", {\r\n                    audioFileUrl: this.props.audioUrl,\r\n                    state: store.getState()\r\n                  });\r\n                  this.props.closedDialog();\r\n                }\r\n              }\r\n            ]}\r\n          ></ModalDialog>\r\n        );\r\n      case DialogType.ADD_SECTION:\r\n        return (\r\n          <AddSectionDialog\r\n            maxMeasure={this.props.maxMeasure}\r\n            onCancel={() => this.props.closedDialog()}\r\n            onSubmit={(sectionType, start, end) => {\r\n              this.props.addedSection({\r\n                measures: ArrayUtil.range(start, end),\r\n                type: sectionType\r\n              });\r\n              this.props.closedDialog();\r\n            }}\r\n          ></AddSectionDialog>\r\n        );\r\n      default:\r\n        throw Error();\r\n    }\r\n  }\r\n}\r\n\r\nconst NewDialog: FunctionComponent<{\r\n  onSubmit: (title: string, fileUrl: string) => void;\r\n  onCancel: () => void;\r\n}> = props => {\r\n  const [fileUrl, setFileUrl] = useState(\"\");\r\n  const [title, setTitle] = useState(\"\");\r\n  const actions: () => DialogAction[] = () => {\r\n    return [\r\n      {\r\n        label: \"Cancel\",\r\n        onClick: () => props.onCancel()\r\n      },\r\n      {\r\n        label: \"Create\",\r\n        onClick: () => props.onSubmit(title, fileUrl),\r\n        disabled: fileUrl === \"\" || title === \"\"\r\n      }\r\n    ];\r\n  };\r\n\r\n  const handleTitleChange = (event: any) => setTitle(event.target.value);\r\n\r\n  return (\r\n    <ModalDialog\r\n      title=\"Create new Transcription\"\r\n      subTitle=\"Please add a project title and select an audio file from your hard disk below.\"\r\n      actions={actions()}\r\n      onCancel={props.onCancel}\r\n    >\r\n      <FormControl fullWidth>\r\n        <TextField\r\n          id=\"title\"\r\n          label=\"Project title\"\r\n          margin=\"normal\"\r\n          InputProps={{\r\n            readOnly: false\r\n          }}\r\n          variant=\"outlined\"\r\n          onChange={handleTitleChange}\r\n        />\r\n        <FileInput\r\n          fileType={FileType.AUDIO}\r\n          id=\"audio_file\"\r\n          callback={(file, fileUrl) => {\r\n            setFileUrl(fileUrl);\r\n          }}\r\n        ></FileInput>\r\n      </FormControl>\r\n    </ModalDialog>\r\n  );\r\n};\r\n\r\nconst OpenDialog: FunctionComponent<{\r\n  onSubmit: (file: File, fileUrl: string) => void;\r\n  onCancel: () => void;\r\n}> = props => {\r\n  const [fileUrl, setFileUrl] = useState(\"\");\r\n  const [file, setFile] = useState<File>();\r\n  const actions: () => DialogAction[] = () => {\r\n    return [\r\n      {\r\n        label: \"Cancel\",\r\n        onClick: () => props.onCancel()\r\n      },\r\n      {\r\n        label: \"Open\",\r\n        onClick: () => props.onSubmit(file!, fileUrl),\r\n        disabled: fileUrl === \"\"\r\n      }\r\n    ];\r\n  };\r\n\r\n  return (\r\n    <ModalDialog\r\n      title=\"Open Transcription\"\r\n      subTitle=\"Please select a project zip file from your hard disk below.\"\r\n      onCancel={props.onCancel}\r\n      actions={actions()}\r\n    >\r\n      <FormControl fullWidth>\r\n        <FileInput\r\n          fileType={FileType.ZIP}\r\n          id=\"zip_file\"\r\n          callback={(file, fileUrl) => {\r\n            setFileUrl(fileUrl);\r\n            setFile(file);\r\n          }}\r\n        ></FileInput>\r\n      </FormControl>\r\n    </ModalDialog>\r\n  );\r\n};\r\n\r\nconst AddSectionDialog: FunctionComponent<{\r\n  maxMeasure: number;\r\n  onSubmit: (sectionType: SectionType, start: number, end: number) => void;\r\n  onCancel: () => void;\r\n}> = props => {\r\n  const [sectionType, setSectionType] = useState(SectionType.INTRO);\r\n  const [start, setStart] = useState(0);\r\n  const [end, setEnd] = useState(0);\r\n  const actions: () => DialogAction[] = () => {\r\n    return [\r\n      {\r\n        label: \"Cancel\",\r\n        onClick: () => props.onCancel()\r\n      },\r\n      {\r\n        label: \"Add\",\r\n        onClick: () => props.onSubmit(sectionType, start, end),\r\n        disabled: sectionType === SectionType.UNDEFINED || start > end\r\n      }\r\n    ];\r\n  };\r\n\r\n  return (\r\n    <ModalDialog\r\n      title=\"Add new Section\"\r\n      subTitle=\"Please define section and add it to the song structure.\"\r\n      actions={actions()}\r\n      onCancel={props.onCancel}\r\n    >\r\n      <FormControl fullWidth style={{ marginBottom: \"20px\" }}>\r\n        <FormLabel component=\"legend\">Section Type</FormLabel>\r\n        <SectionSelect\r\n          value={sectionType}\r\n          onChange={sectionType => setSectionType(sectionType)}\r\n        ></SectionSelect>\r\n      </FormControl>\r\n      <FormControl fullWidth style={{ marginBottom: \"20px\" }}>\r\n        <FormLabel component=\"legend\">First Measure</FormLabel>\r\n        <MeasureSelect\r\n          value={start}\r\n          min={0}\r\n          max={props.maxMeasure}\r\n          onChange={value => setStart(value)}\r\n        />\r\n      </FormControl>\r\n      <FormControl fullWidth style={{ marginBottom: \"20px\" }}>\r\n        <FormLabel component=\"legend\">Last Measure</FormLabel>\r\n        <MeasureSelect\r\n          value={end}\r\n          min={0}\r\n          max={props.maxMeasure}\r\n          onChange={value => setEnd(value)}\r\n        />\r\n      </FormControl>\r\n    </ModalDialog>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = ({ dialog, project, analysis }: ApplicationState) => {\r\n  return {\r\n    type: dialog.currentDialog,\r\n    audioUrl: project.audioUrl,\r\n    maxMeasure: analysis.measures.allIds.length - 1\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  closedDialog,\r\n  switchedPage,\r\n  createdProject,\r\n  addedSection\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DialogManagement);\r\n","import blueGrey from \"@material-ui/core/colors/blueGrey\";\nimport { createMuiTheme } from \"@material-ui/core/styles\";\n// A custom theme for this app\nconst theme = createMuiTheme({\n  palette: {\n    type: \"light\",\n    primary: blueGrey\n  }\n});\n\nexport default theme;\n","import CssBaseline from \"@material-ui/core/CssBaseline\";\nimport { ThemeProvider } from \"@material-ui/core/styles\";\nimport React from \"react\";\nimport { render } from \"react-dom\";\nimport { Provider } from \"react-redux\";\n\nimport App from \"./components/app/app\";\nimport AudioManagement from \"./components/audioManagement/audioManagement\";\nimport DialogManagement from \"./components/dialogManagement/dialogManagement\";\nimport store from \"./states/store\";\nimport theme from \"./styles/theme\";\n\nif (process.env.NODE_ENV !== \"production\") {\n  localStorage.setItem(\"debug\", \"transcribe:*\");\n}\n\nconst renderApp = () =>\n  render(\n    <Provider store={store}>\n      <ThemeProvider theme={theme}>\n        {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\n        <CssBaseline />\n        <AudioManagement />\n        <DialogManagement />\n        <App />\n      </ThemeProvider>\n    </Provider>,\n    document.getElementById(\"root\")\n  );\n\nif (process.env.NODE_ENV !== \"production\" && module.hot) {\n  module.hot.accept(\"./components/app/app\", renderApp);\n}\n\nrenderApp();\n"],"sourceRoot":""}